/* ═══════════════════════════════════════════════════════════════
   Novyn — Deep Space + Light Mode  v3
   ═══════════════════════════════════════════════════════════════ */

/* ── Dark theme (default) ──────────────────────── */
:root {
  --bg-void:       #05080f;
  --bg-surface:    rgba(255,255,255,0.042);
  --bg-surface-2:  rgba(255,255,255,0.072);

  --cyan:    #00e5ff;
  --violet:  #7c3aed;
  --purple:  #a855f7;
  --pink:    #f72585;
  --gold:    #f9a825;
  --online:  #00c97a;
  --danger:  #ff4d6d;

  --t1: #eef2f8;
  --t2: rgba(200,215,240,0.62);
  --t3: rgba(200,215,240,0.34);

  --b1: rgba(255,255,255,0.08);
  --b2: rgba(255,255,255,0.12);

  --g-brand:  linear-gradient(135deg, #00e5ff 0%, #7c3aed 100%);
  --g-warm:   linear-gradient(135deg, #f9a825 0%, #f72585 100%);
  --g-send:   linear-gradient(135deg, #00e5ff 0%, #0055cc 100%);
  --g-me-msg: linear-gradient(145deg, rgba(0,229,255,0.11), rgba(124,58,237,0.14));

  --glow-c:  0 0 20px rgba(0,229,255,0.18);
  --glow-ok: 0 0 14px rgba(0,201,122,0.20);
  --s1: 0 2px 8px  rgba(0,0,0,0.45);
  --s2: 0 8px 28px rgba(0,0,0,0.55);
  --s3: 0 24px 72px rgba(0,0,0,0.72);

  --card-bg:       rgba(255,255,255,0.042);
  --card-border:   rgba(255,255,255,0.08);
  --input-bg:      rgba(255,255,255,0.05);
  --input-border:  rgba(255,255,255,0.09);
  --hero-bg:       rgba(7,12,26,0.90);
  --panel-bg:      rgba(8,13,28,0.88);
  --msg-them-bg:   rgba(255,255,255,0.05);
  --msg-them-bdr:  rgba(255,255,255,0.07);
  --mob-bg:        #05080f;
  --mob-bar-bg:    rgba(5,8,15,0.90);

  --r1: 8px; --r2: 14px; --r3: 20px; --r4: 28px; --rp: 999px;
  --sidebar-w: 310px;
  --topbar-h:  68px;

  /* Theme toggle track colors */
  --toggle-track: rgba(255,255,255,0.1);
  --toggle-thumb: #fff;
}

/* ── Light theme ────────────────────────────────── */
:root.light {
  --bg-void:       #f0f4ff;
  --bg-surface:    rgba(255,255,255,0.72);
  --bg-surface-2:  rgba(255,255,255,0.90);

  --t1: #0d1120;
  --t2: rgba(15,25,60,0.60);
  --t3: rgba(15,25,60,0.35);

  --b1: rgba(0,0,0,0.08);
  --b2: rgba(0,0,0,0.12);

  --glow-c:  0 0 20px rgba(0,180,210,0.12);
  --glow-ok: 0 0 14px rgba(0,160,100,0.14);
  --s1: 0 2px 8px  rgba(0,0,0,0.08);
  --s2: 0 8px 28px rgba(0,0,0,0.10);
  --s3: 0 24px 72px rgba(0,0,0,0.14);

  --card-bg:       rgba(255,255,255,0.80);
  --card-border:   rgba(0,0,0,0.07);
  --input-bg:      rgba(0,0,0,0.04);
  --input-border:  rgba(0,0,0,0.10);
  --hero-bg:       rgba(230,238,255,0.95);
  --panel-bg:      rgba(255,255,255,0.92);
  --msg-them-bg:   rgba(255,255,255,0.90);
  --msg-them-bdr:  rgba(0,0,0,0.07);
  --mob-bg:        #f0f4ff;
  --mob-bar-bg:    rgba(240,244,255,0.92);

  --toggle-track: rgba(0,0,0,0.12);
  --toggle-thumb: #fff;
}

/* ── CSS transitions for theme switch ──────────── */
body,
.card, .sidebar, .chat, .me-row, .chat-header,
.message-form, .app-topbar, .login-hero, .login-panel,
input, .item-card, .friend-btn, .toast,
.mob-back-btn, .list-head h3 {
  transition:
    background 0.4s ease,
    border-color 0.4s ease,
    color 0.4s ease,
    box-shadow 0.4s ease;
}

/* ═══ Reset ═════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; }
html { height: 100%; }
body { height: 100%; margin: 0; }
h1,h2,h3,h4,p { margin: 0; }
ul { margin: 0; padding: 0; list-style: none; }

/* ═══ Base ══════════════════════════════════════ */
body {
  font-family: 'Outfit', system-ui, sans-serif;
  font-size: 14.5px;
  line-height: 1.55;
  color: var(--t1);
  background: var(--bg-void);
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
}
h1,h2,h3 { letter-spacing: -0.02em; font-weight: 700; }

/* ═══ Ambient blobs ══════════════════════════════ */
.bg-shape {
  position: fixed; z-index: 0;
  pointer-events: none;
  border-radius: 50%;
  filter: blur(90px);
  animation: driftBlob 25s ease-in-out infinite;
}
.bg-shape-one {
  width: 80vw; height: 80vw; max-width: 900px; max-height: 900px;
  top: -30%; left: -20%;
  background: radial-gradient(circle, rgba(0,229,255,0.16) 0%, rgba(124,58,237,0.10) 50%, transparent 100%);
}
.bg-shape-two {
  width: 70vw; height: 70vw; max-width: 800px; max-height: 800px;
  bottom: -25%; right: -18%;
  background: radial-gradient(circle, rgba(247,37,133,0.13) 0%, rgba(124,58,237,0.09) 50%, transparent 100%);
  animation-delay: -12s; animation-direction: reverse;
}
:root.light .bg-shape-one {
  background: radial-gradient(circle, rgba(0,180,255,0.10) 0%, rgba(124,58,237,0.06) 50%, transparent 100%);
}
:root.light .bg-shape-two {
  background: radial-gradient(circle, rgba(247,37,133,0.07) 0%, rgba(124,58,237,0.05) 50%, transparent 100%);
}

.grain-layer {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.028;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  background-size: 250px 250px;
}

/* ═══ App shell ══════════════════════════════════ */
.app-shell {
  position: relative; z-index: 1;
  display: flex; flex-direction: column;
  flex: 1; min-height: 0;
  max-width: 1320px; width: 100%;
  margin: 0 auto;
  padding: 20px clamp(14px, 2.8vw, 32px) 24px;
  overflow: hidden;
}

/* ═══ Top bar ════════════════════════════════════ */
.app-topbar {
  display: flex; justify-content: space-between; align-items: center;
  gap: 12px; height: var(--topbar-h); flex-shrink: 0; margin-bottom: 16px;
}

.topbar-right {
  display: flex; align-items: center; gap: 10px;
}

/* ── Brand ────────────────────────────────────── */
.brand { display: flex; align-items: center; gap: 13px; }

/* ── SVG Logo mark ─────────────────────────────
   A proper animated ripple-wave mark: two concentric
   circles that expand outward like a water ripple.
   Built entirely in SVG so it's crisp at any size.  */
.brand-logo {
  flex-shrink: 0;
  width: 42px; height: 42px;
}
.brand-logo-ring {
  transform-origin: 50% 50%;
  animation: logoRipple 2.8s ease-out infinite;
}
.brand-logo-ring:nth-child(2) { animation-delay: 0.9s; }
.brand-logo-ring:nth-child(3) { animation-delay: 1.8s; }

.eyebrow {
  font-size: 0.64rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.14em;
  color: var(--t3);
}
.brand .eyebrow { color: rgba(0,229,255,0.7); }
:root.light .brand .eyebrow { color: rgba(0,140,200,0.8); }

.brand h1 {
  font-size: clamp(1.28rem, 2vw, 1.7rem); font-weight: 800;
  background: var(--g-brand);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; letter-spacing: -0.035em; margin-top: 1px;
}

/* ── Network pill ─────────────────────────────── */
.network-pill {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 8px 14px; border-radius: var(--rp);
  border: 1px solid var(--b1); background: var(--bg-surface);
  backdrop-filter: blur(16px);
  font-size: 0.8rem; font-weight: 600; color: var(--t2);
  transition: border-color 0.35s, color 0.35s, box-shadow 0.35s;
}
.network-pill.connected { border-color: rgba(0,201,122,0.28); color: var(--online); box-shadow: var(--glow-ok); }
.network-pill.offline   { border-color: rgba(255,77,109,0.28); color: var(--danger); }

.signal-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: var(--t3); flex-shrink: 0;
}
.network-pill.connected .signal-dot, .signal-dot.online {
  background: var(--online);
  box-shadow: 0 0 0 3px rgba(0,201,122,0.18);
  animation: pulseDot 2.2s ease-in-out infinite;
}
.network-pill.offline .signal-dot { background: var(--danger); box-shadow: 0 0 0 3px rgba(255,77,109,0.15); }

/* ═══════════════════════════════════════════════
   THEME TOGGLE
   A pill-shaped switch: moon → sun
   ═══════════════════════════════════════════════ */
.theme-toggle {
  position: relative;
  width: 52px; height: 28px;
  border-radius: var(--rp);
  border: 1px solid var(--b2);
  background: var(--toggle-track);
  cursor: pointer;
  flex-shrink: 0;
  padding: 0;
  box-shadow: none;
  transition: background 0.4s, border-color 0.4s;
  overflow: visible;
}
.theme-toggle:hover { transform: none; filter: none; box-shadow: none; }

/* Thumb — the sliding circle */
.theme-toggle-thumb {
  position: absolute;
  top: 3px; left: 3px;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: var(--toggle-thumb);
  box-shadow: 0 1px 4px rgba(0,0,0,0.35);
  transition: left 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.35s;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
:root.light .theme-toggle-thumb { left: 27px; }

/* Moon icon (dark mode) */
.icon-moon, .icon-sun {
  position: absolute;
  width: 12px; height: 12px;
  transition: opacity 0.25s, transform 0.35s;
}
.icon-moon { opacity: 1; transform: rotate(0deg); }
.icon-sun  { opacity: 0; transform: rotate(90deg); }
:root.light .icon-moon { opacity: 0; transform: rotate(-90deg); }
:root.light .icon-sun  { opacity: 1; transform: rotate(0deg); }

/* Glow ring around toggle in light mode */
:root.light .theme-toggle {
  background: rgba(253,185,20,0.18);
  border-color: rgba(253,185,20,0.35);
  box-shadow: 0 0 12px rgba(253,185,20,0.20);
}

/* ═══ Card base ══════════════════════════════════ */
.card {
  border: 1px solid var(--card-border);
  border-radius: var(--r4);
  background: var(--card-bg);
  backdrop-filter: blur(22px) saturate(1.5);
  box-shadow: var(--s3), inset 0 1px 0 rgba(255,255,255,0.055);
}
:root.light .card { box-shadow: var(--s2), inset 0 1px 0 rgba(255,255,255,0.9); }

.hidden { display: none !important; }

/* ═══════════════════════════════════════════════
   LOGIN PAGE
   ═══════════════════════════════════════════════ */
.login-card {
  display: grid;
  grid-template-columns: 1.38fr 1fr;
  gap: 18px; padding: 18px;
  animation: fadeUp 0.55s cubic-bezier(0.22, 1, 0.36, 1);
  align-self: start; margin-top: 4px;
}

.login-hero {
  position: relative; display: flex; flex-direction: column; gap: 20px;
  border-radius: var(--r3);
  border: 1px solid rgba(0,229,255,0.10);
  background:
    radial-gradient(ellipse 60% 40% at 15% 0%, rgba(0,229,255,0.07) 0%, transparent 100%),
    radial-gradient(ellipse 50% 50% at 85% 100%, rgba(124,58,237,0.10) 0%, transparent 100%),
    var(--hero-bg);
  padding: clamp(22px, 2.8vw, 34px); overflow: hidden;
}
:root.light .login-hero { border-color: rgba(0,140,200,0.12); }
.login-hero::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent 0%, rgba(0,229,255,0.45) 50%, transparent 100%);
}
:root.light .login-hero::before { background: linear-gradient(90deg, transparent 0%, rgba(0,140,200,0.3) 50%, transparent 100%); }
.login-hero .eyebrow { color: var(--cyan); opacity: 0.9; }
:root.light .login-hero .eyebrow { color: #0070a8; }
.login-hero h2 {
  font-size: clamp(1.75rem, 3vw, 2.75rem); font-weight: 800; line-height: 1.06; max-width: 16ch;
  background: linear-gradient(145deg, #fff 35%, rgba(0,229,255,0.75) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
:root.light .login-hero h2 {
  background: linear-gradient(145deg, #0d1120 35%, #0070a8 100%);
  -webkit-background-clip: text; background-clip: text;
}
.login-hero > p { color: var(--t2); font-size: 0.92rem; line-height: 1.65; max-width: 48ch; }

.hero-visual {
  position: relative; border-radius: var(--r2);
  border: 1px solid rgba(0,229,255,0.08);
  background: rgba(5,10,22,0.82);
  overflow: hidden; height: 235px;
}
:root.light .hero-visual { background: rgba(225,235,252,0.70); border-color: rgba(0,140,200,0.10); }
.hero-visual::after { display: none; }
/* Remove old SVG — mockup replaces it */
.hero-svg { display: none; }

.float-pill { display: none; } .float-pill-DISABLED {
  position: absolute; z-index: 2; border-radius: var(--rp);
  padding: 6px 13px; font-size: 0.72rem; font-weight: 700;
  backdrop-filter: blur(14px); white-space: nowrap; letter-spacing: 0.01em;
}
.float-pill-one { left: 12px; bottom: 12px; background: rgba(249,168,37,0.14); border: 1px solid rgba(249,168,37,0.32); color: var(--gold); animation: floatTag 5s ease-in-out infinite; }
.float-pill-two { right: 12px; top: 12px; background: rgba(0,229,255,0.10); border: 1px solid rgba(0,229,255,0.28); color: var(--cyan); animation: floatTag 5s ease-in-out infinite; animation-delay: -2.5s; }

.feature-list { display: flex; flex-direction: column; gap: 10px; margin-top: auto; }
.feature-list li { display: flex; align-items: center; gap: 10px; font-size: 0.88rem; font-weight: 500; color: var(--t2); }
.feature-list li::before { content: ''; flex-shrink: 0; width: 7px; height: 7px; border-radius: 50%; background: var(--cyan); box-shadow: 0 0 8px var(--cyan); }

.login-panel {
  display: flex; flex-direction: column; gap: 18px;
  border-radius: var(--r3); border: 1px solid var(--card-border);
  background: var(--panel-bg);
  padding: clamp(22px, 2.8vw, 32px); justify-content: center;
}
.login-panel h3 { font-size: 1.55rem; font-weight: 800; color: var(--t1); }
.login-panel > p { color: var(--t2); font-size: 0.88rem; margin-top: -6px; line-height: 1.55; }

#loginForm { display: flex; flex-direction: column; gap: 10px; }

.username-hint { color: var(--gold); font-size: 0.82rem; font-weight: 600; }
:root.light .username-hint { color: #b07800; }

.username-suggestions { display: flex; flex-wrap: wrap; gap: 8px; }
.suggestion-chip {
  padding: 6px 12px; border-radius: var(--rp);
  border: 1px solid rgba(0,229,255,0.20); background: rgba(0,229,255,0.06);
  color: var(--cyan); font-size: 0.78rem; font-weight: 600;
  cursor: pointer; transition: background 0.18s, border-color 0.18s; font-family: inherit;
}
.suggestion-chip:hover { background: rgba(0,229,255,0.13); border-color: rgba(0,229,255,0.4); }
:root.light .suggestion-chip { color: #0070a8; border-color: rgba(0,112,168,0.22); background: rgba(0,112,168,0.06); }
:root.light .suggestion-chip:hover { background: rgba(0,112,168,0.12); }

.login-footnote { font-size: 0.74rem; color: var(--t3); font-weight: 500; margin-top: -4px; }

/* ═══ Form controls ══════════════════════════════ */
input, button { font: inherit; }

input {
  width: 100%; padding: 12px 15px;
  border-radius: var(--r1); border: 1px solid var(--input-border);
  background: var(--input-bg); color: var(--t1);
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
  -webkit-appearance: none;
}
input::placeholder { color: var(--t3); }
input:focus {
  outline: none; border-color: rgba(0,229,255,0.42);
  background: rgba(0,229,255,0.04); box-shadow: 0 0 0 3px rgba(0,229,255,0.09);
}
:root.light input:focus { border-color: rgba(0,112,168,0.42); background: rgba(0,112,168,0.04); box-shadow: 0 0 0 3px rgba(0,112,168,0.09); }

button {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 12px 20px; border: none; border-radius: var(--r1);
  background: var(--g-brand); color: #fff;
  font-weight: 700; font-size: 0.92rem; letter-spacing: 0.01em;
  cursor: pointer; transition: transform 0.15s ease, filter 0.15s ease, box-shadow 0.15s;
  box-shadow: 0 4px 18px rgba(0,229,255,0.18); white-space: nowrap;
}
button:hover { transform: translateY(-2px); filter: brightness(1.1); box-shadow: 0 8px 28px rgba(0,229,255,0.28); }
button:active { transform: translateY(0); filter: brightness(0.96); }
button:disabled { cursor: not-allowed; opacity: 0.4; filter: grayscale(0.3); transform: none; box-shadow: none; }

#loginForm button { background: var(--g-warm); box-shadow: 0 4px 22px rgba(247,37,133,0.22); padding: 14px; font-size: 0.97rem; width: 100%; }
#loginForm button:hover { box-shadow: 0 8px 30px rgba(247,37,133,0.34); }

/* ═══ Chat layout ════════════════════════════════ */
.chat-layout {
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr;
  grid-template-rows: 1fr;
  gap: 14px; flex: 1; height: 0; min-height: 0;
  animation: fadeUp 0.48s cubic-bezier(0.22, 1, 0.36, 1);
  overflow: hidden;
}

/* ═══ Sidebar ════════════════════════════════════ */
.sidebar {
  display: grid; grid-template-rows: auto auto auto 1fr;
  gap: 10px; padding: 14px; height: 100%; min-height: 0; overflow: hidden;
}

.me-row {
  display: flex; justify-content: space-between; align-items: center;
  gap: 10px; padding: 11px 14px; border-radius: var(--r2);
  border: 1px solid rgba(0,229,255,0.09);
  background: radial-gradient(ellipse 80% 80% at 0% 50%, rgba(0,229,255,0.05), transparent), rgba(255,255,255,0.027);
  flex-shrink: 0;
}
:root.light .me-row { border-color: rgba(0,112,168,0.12); background: radial-gradient(ellipse 80% 80% at 0% 50%, rgba(0,112,168,0.05), transparent), rgba(255,255,255,0.6); }

/* ── Avatar initials ───────────────────────────── */
.me-avatar {
  width: 36px; height: 36px; border-radius: 50%;
  background: var(--g-brand);
  display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 0.85rem; color: #fff;
  letter-spacing: 0; flex-shrink: 0;
  box-shadow: 0 0 0 2px rgba(0,229,255,0.22), var(--glow-c);
}
.me-row-info { display: flex; align-items: center; gap: 10px; min-width: 0; }
.me-row-text { min-width: 0; }
.me-row-text h2 {
  font-size: 1.02rem; font-weight: 700; margin-top: 1px;
  background: var(--g-brand); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.presence-pill {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 5px 11px; border-radius: var(--rp);
  border: 1px solid rgba(0,201,122,0.20); background: rgba(0,201,122,0.08);
  color: var(--online); font-size: 0.74rem; font-weight: 600; flex-shrink: 0;
}

.add-friend-form { display: grid; grid-template-columns: 1fr auto; gap: 8px; flex-shrink: 0; }
.add-friend-form input { font-size: 0.88rem; }
.add-friend-form button {
  background: rgba(255,255,255,0.06); border: 1px solid var(--b2);
  box-shadow: none; color: var(--cyan); font-size: 0.85rem; padding: 0 16px;
}
.add-friend-form button:hover { background: rgba(0,229,255,0.08); border-color: rgba(0,229,255,0.32); box-shadow: none; transform: none; }
:root.light .add-friend-form button { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.10); color: #0070a8; }

.list-panel { display: grid; grid-template-rows: auto 1fr; gap: 8px; min-height: 0; overflow: hidden; }
.list-panel:not(.friends-panel) { max-height: 190px; }
.friends-panel { min-height: 0; overflow: hidden; }

.list-head { display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.list-head h3 { font-size: 0.73rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.12em; color: var(--t3); }

.count-pill {
  padding: 2px 9px; border-radius: var(--rp);
  font-size: 0.68rem; font-weight: 800; color: var(--cyan);
  background: rgba(0,229,255,0.10); border: 1px solid rgba(0,229,255,0.18);
}
:root.light .count-pill { color: #0070a8; background: rgba(0,112,168,0.10); border-color: rgba(0,112,168,0.18); }

#requestList, #friendList {
  overflow-y: auto; display: flex; flex-direction: column;
  gap: 5px; min-height: 0; padding-right: 2px;
  scrollbar-width: thin; scrollbar-color: rgba(0,229,255,0.18) transparent;
}

.item-card {
  border-radius: var(--r1); border: 1px solid var(--b1);
  background: rgba(255,255,255,0.035);
  padding: 10px 12px; color: var(--t2); font-weight: 500;
  transition: border-color 0.18s, background 0.18s; flex-shrink: 0;
}
.item-card:hover { border-color: rgba(0,229,255,0.14); background: rgba(0,229,255,0.035); }
:root.light .item-card { background: rgba(255,255,255,0.70); }
:root.light .item-card:hover { background: rgba(0,112,168,0.05); border-color: rgba(0,112,168,0.14); }

.request-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.request-row span { font-size: 0.88rem; color: var(--t1); font-weight: 600; }
.request-row button { padding: 5px 12px; border-radius: 7px; font-size: 0.76rem; box-shadow: none; }

/* ── Friend item with avatar ────────────────────── */
.friend-btn {
  width: 100%; display: flex; justify-content: space-between; align-items: center;
  gap: 10px; padding: 9px 10px; border: 1px solid transparent; border-radius: var(--r1);
  background: rgba(255,255,255,0.025); color: var(--t1);
  text-align: left; font-weight: 500; font-size: 0.9rem;
  cursor: pointer; transition: background 0.18s, border-color 0.18s;
  box-shadow: none; flex-shrink: 0;
}
.friend-btn:hover { background: rgba(0,229,255,0.055); border-color: rgba(0,229,255,0.14); transform: none; filter: none; box-shadow: none; }
.friend-btn.active { background: rgba(0,229,255,0.08); border-color: rgba(0,229,255,0.26); }
:root.light .friend-btn { background: rgba(255,255,255,0.50); }
:root.light .friend-btn:hover { background: rgba(0,112,168,0.06); border-color: rgba(0,112,168,0.14); }
:root.light .friend-btn.active { background: rgba(0,112,168,0.10); border-color: rgba(0,112,168,0.26); }

.friend-avatar {
  width: 34px; height: 34px; border-radius: 50%;
  background: var(--g-brand); display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 0.78rem; color: #fff; flex-shrink: 0;
  position: relative;
}
/* Online presence dot on avatar */
.friend-avatar::after {
  content: ''; position: absolute; bottom: 1px; right: 1px;
  width: 9px; height: 9px; border-radius: 50%;
  background: var(--t3);
  border: 2px solid var(--bg-void);
  transition: background 0.3s;
}
.friend-avatar.online::after { background: var(--online); box-shadow: 0 0 6px var(--online); }

.friend-main { display: flex; flex-direction: column; gap: 2px; min-width: 0; flex: 1; }
.friend-name { font-weight: 700; font-size: 0.91rem; color: var(--t1); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.friend-preview { font-size: 0.74rem; color: var(--t3); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

.friend-side { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; flex-shrink: 0; }
.status { font-size: 0.72rem; color: var(--t3); font-weight: 500; }
.status.online { color: var(--online); }

.unread-badge {
  padding: 2px 7px; border-radius: var(--rp); min-width: 1.3rem;
  text-align: center; font-size: 0.66rem; font-weight: 800;
  color: var(--bg-void); background: var(--cyan);
  box-shadow: 0 0 10px rgba(0,229,255,0.45);
}

/* ═══ Chat panel ═════════════════════════════════ */
.chat {
  display: grid; grid-template-rows: auto 1fr auto auto;
  gap: 10px; padding: 14px; height: 100%; min-height: 0; overflow: hidden;
}

.chat-header {
  display: flex; align-items: center; justify-content: space-between;
  gap: 14px; padding: 11px 16px; border-radius: var(--r2);
  border: 1px solid rgba(0,229,255,0.08);
  background: radial-gradient(ellipse 80% 80% at 100% 50%, rgba(124,58,237,0.06), transparent), rgba(255,255,255,0.027);
  flex-shrink: 0;
}
:root.light .chat-header { border-color: rgba(0,112,168,0.10); background: radial-gradient(ellipse 80% 80% at 100% 50%, rgba(0,112,168,0.04), transparent), rgba(255,255,255,0.80); }

.chat-header-info { flex: 1; min-width: 0; }
.chat-header h2 { font-size: clamp(1.05rem, 1.6vw, 1.35rem); font-weight: 700; margin-top: 1px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

.mini-stat {
  padding: 5px 13px; border-radius: var(--rp);
  border: 1px solid rgba(0,201,122,0.18); background: rgba(0,201,122,0.06);
  color: var(--online); font-size: 0.73rem; font-weight: 600; white-space: nowrap; flex-shrink: 0;
}

/* ═══ Messages ═══════════════════════════════════ */
/* Wrapper makes the scroll area + button a single stacking context */
.messages-wrap {
  position: relative; min-height: 0; overflow: hidden;
  display: flex; flex-direction: column;
}

.messages {
  display: flex; flex-direction: column; gap: 8px;
  overflow-y: scroll; overflow-x: hidden;
  padding: 4px 6px 4px 2px; min-height: 0;
  scrollbar-width: thin; scrollbar-color: rgba(0,229,255,0.18) transparent;
  flex: 1;
}

/* ── Scroll-to-bottom FAB ───────────────────────── */
.scroll-btn {
  position: absolute; bottom: 12px; right: 12px; z-index: 10;
  width: 36px; height: 36px; border-radius: 50%;
  background: var(--g-brand); border: none; box-shadow: var(--s2), var(--glow-c);
  color: #fff; cursor: pointer; padding: 0;
  display: flex; align-items: center; justify-content: center;
  transform: scale(0) translateY(8px);
  opacity: 0;
  transition: transform 0.22s cubic-bezier(0.34,1.56,0.64,1), opacity 0.22s ease;
  pointer-events: none;
}
.scroll-btn.visible {
  transform: scale(1) translateY(0);
  opacity: 1;
  pointer-events: auto;
}
.scroll-btn:hover { transform: scale(1.08) translateY(0); filter: brightness(1.1); }

/* Unread count badge on FAB */
.scroll-btn-badge {
  position: absolute; top: -4px; right: -4px;
  min-width: 16px; height: 16px; padding: 0 4px;
  border-radius: var(--rp); background: var(--pink);
  font-size: 0.6rem; font-weight: 800; color: #fff;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 8px rgba(247,37,133,0.5);
}

.messages-empty {
  margin: auto; text-align: center; padding: 28px 36px;
  border-radius: var(--r2); border: 1px dashed rgba(0,229,255,0.09);
  background: rgba(0,229,255,0.018);
  color: var(--t3); font-size: 0.88rem; font-weight: 500; line-height: 1.6;
}
:root.light .messages-empty { border-color: rgba(0,112,168,0.12); background: rgba(0,112,168,0.03); }

/* ── Typing indicator ───────────────────────────── */
.typing-indicator {
  display: inline-flex; align-items: center; gap: 8px;
  min-height: 22px; padding: 0 4px;
  color: var(--t3); font-size: 0.8rem; font-weight: 500; flex-shrink: 0;
}
.typing-dots { display: inline-flex; gap: 3px; }
.typing-dots span {
  width: 5px; height: 5px; border-radius: 50%;
  background: var(--cyan); opacity: 0.4;
  animation: typingBounce 1.1s ease-in-out infinite;
}
.typing-dots span:nth-child(2) { animation-delay: 0.16s; }
.typing-dots span:nth-child(3) { animation-delay: 0.32s; }

/* ── Message bubbles ────────────────────────────── */
.message {
  max-width: min(70%, 560px);
  padding: 10px 14px; border-radius: var(--r2);
  line-height: 1.5; word-break: break-word;
  animation: bubblePop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  flex-shrink: 0; position: relative;
}
.message.them {
  align-self: flex-start;
  border: 1px solid var(--msg-them-bdr);
  background: var(--msg-them-bg);
  border-bottom-left-radius: 4px;
}
.message.me {
  align-self: flex-end;
  background: var(--g-me-msg);
  border: 1px solid rgba(0,229,255,0.17);
  border-bottom-right-radius: 4px;
}
:root.light .message.me { border-color: rgba(0,112,168,0.20); }

.message-meta {
  display: block; margin-bottom: 5px;
  font-size: 0.7rem; font-weight: 600;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.message.them .message-meta { color: var(--t3); }
.message.me   .message-meta { color: rgba(0,229,255,0.55); text-align: right; }
:root.light .message.me .message-meta { color: rgba(0,112,168,0.55); }

/* ── Emoji reactions on messages ────────────────── */
.message-reactions {
  display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px;
}
.reaction-btn {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; border-radius: var(--rp);
  background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.10);
  font-size: 0.78rem; font-weight: 600; color: var(--t2);
  cursor: pointer; box-shadow: none; transition: background 0.15s, border-color 0.15s;
}
.reaction-btn:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.20); transform: none; filter: none; }
.reaction-btn.mine { background: rgba(0,229,255,0.10); border-color: rgba(0,229,255,0.28); color: var(--cyan); }
:root.light .reaction-btn { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); color: var(--t2); }
:root.light .reaction-btn.mine { background: rgba(0,112,168,0.10); border-color: rgba(0,112,168,0.28); color: #0070a8; }

/* ── Reaction picker popover ────────────────────── */
.reaction-picker {
  position: absolute; bottom: calc(100% + 6px);
  background: var(--panel-bg);
  border: 1px solid var(--b1); border-radius: var(--r2);
  padding: 6px 8px; display: flex; gap: 4px;
  box-shadow: var(--s2);
  backdrop-filter: blur(16px);
  z-index: 20; animation: fadeUp 0.15s ease;
  pointer-events: auto;
}
.message.me   .reaction-picker { right: 0; }
.message.them .reaction-picker { left: 0; }
.reaction-picker button {
  background: none; border: none; padding: 4px;
  font-size: 1.1rem; border-radius: 6px; box-shadow: none;
  cursor: pointer; transition: background 0.12s, transform 0.12s;
}
.reaction-picker button:hover { background: rgba(255,255,255,0.10); transform: scale(1.25); filter: none; box-shadow: none; }

/* ── Message hover area ─────────────────────────── */
.message:hover .msg-actions { opacity: 1; pointer-events: auto; }
.msg-actions {
  position: absolute; top: -14px;
  display: flex; gap: 3px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.15s;
}
.message.me   .msg-actions { right: 4px; }
.message.them .msg-actions { left: 4px; }
.msg-action-btn {
  width: 26px; height: 26px; border-radius: 50%; padding: 0;
  background: var(--panel-bg); border: 1px solid var(--b1);
  color: var(--t2); cursor: pointer; box-shadow: var(--s1);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.78rem;
  transition: background 0.12s, transform 0.12s;
}
.msg-action-btn:hover { background: rgba(0,229,255,0.1); transform: scale(1.12); filter: none; box-shadow: var(--s1); }

/* ═══ Message form ════════════════════════════════ */
.message-form-wrap { display: flex; flex-direction: column; gap: 4px; flex-shrink: 0; }

.message-form {
  display: grid; grid-template-columns: 1fr auto;
  gap: 8px; padding: 7px; border-radius: var(--r2);
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  transition: border-color 0.2s, box-shadow 0.2s; flex-shrink: 0;
}
.message-form:focus-within { border-color: rgba(0,229,255,0.24); box-shadow: 0 0 0 2px rgba(0,229,255,0.06); }
:root.light .message-form { border-color: rgba(0,0,0,0.08); background: rgba(255,255,255,0.70); }
:root.light .message-form:focus-within { border-color: rgba(0,112,168,0.28); box-shadow: 0 0 0 2px rgba(0,112,168,0.08); }

.message-form input {
  border: none; background: transparent; padding: 10px 12px;
  font-size: 0.93rem; box-shadow: none !important;
}
.message-form input:disabled { color: var(--t3); }
.message-form button {
  background: var(--g-send); box-shadow: 0 0 18px rgba(0,229,255,0.14);
  padding: 0 22px; font-size: 0.88rem;
}
.message-form button:hover { box-shadow: 0 6px 22px rgba(0,229,255,0.30); }

/* ── Character counter ──────────────────────────── */
.char-counter {
  font-size: 0.68rem; font-weight: 600; color: var(--t3);
  text-align: right; padding: 0 4px;
  transition: color 0.2s;
}
.char-counter.warn  { color: var(--gold); }
.char-counter.limit { color: var(--danger); }

/* ═══ Toast ══════════════════════════════════════ */
.toast {
  position: fixed; right: 20px; bottom: 20px; z-index: 200;
  max-width: 320px; padding: 12px 16px;
  border-radius: var(--r2); border: 1px solid rgba(0,229,255,0.18);
  border-left: 3px solid var(--cyan);
  background: rgba(8,13,26,0.96); backdrop-filter: blur(22px);
  color: var(--t1); font-weight: 600; font-size: 0.87rem;
  box-shadow: var(--s2), var(--glow-c);
  animation: toastSlide 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.toast.error { border-left-color: var(--danger); border-color: rgba(255,77,109,0.18); box-shadow: var(--s2), 0 0 18px rgba(255,77,109,0.14); }
:root.light .toast { background: rgba(250,252,255,0.97); color: var(--t1); border-color: rgba(0,112,168,0.18); border-left-color: #0070a8; box-shadow: var(--s2); }
:root.light .toast.error { border-left-color: var(--danger); border-color: rgba(255,77,109,0.18); }

/* ═══ Scrollbars ═════════════════════════════════ */
#requestList::-webkit-scrollbar, #friendList::-webkit-scrollbar, .messages::-webkit-scrollbar { width: 4px; }
#requestList::-webkit-scrollbar-thumb, #friendList::-webkit-scrollbar-thumb, .messages::-webkit-scrollbar-thumb { background: rgba(0,229,255,0.18); border-radius: var(--rp); }
#requestList::-webkit-scrollbar-track, #friendList::-webkit-scrollbar-track, .messages::-webkit-scrollbar-track { background: transparent; }

/* ═══ Mobile back button ═════════════════════════ */
.mob-back-btn { display: none; }

/* ═══════════════════════════════════════════════
   KEYFRAMES
   ═══════════════════════════════════════════════ */
@keyframes driftBlob {
  0%,100% { transform: translate(0,0) scale(1); }
  33%      { transform: translate(3%,2%) scale(1.05); }
  66%      { transform: translate(-2%,-3%) scale(0.96); }
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes bubblePop {
  from { opacity: 0; transform: scale(0.94) translateY(4px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}
@keyframes typingBounce {
  0%,60%,100% { transform: translateY(0); opacity: 0.3; }
  30%          { transform: translateY(-5px); opacity: 1; }
}
@keyframes pulseDot {
  0%,100% { box-shadow: 0 0 0 3px rgba(0,201,122,0.15); }
  50%      { box-shadow: 0 0 0 6px rgba(0,201,122,0.05); }
}
@keyframes pulseGlow {
  0%,100% { opacity: 0.85; }
  50%      { opacity: 1; }
}
@keyframes floatTag {
  0%,100% { transform: translateY(0); }
  50%      { transform: translateY(-7px); }
}
@keyframes toastSlide {
  from { opacity: 0; transform: translateX(18px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes logoRipple {
  0%   { opacity: 0.9; transform: scale(0.6); }
  60%  { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0;   transform: scale(1.2); }
}

/* ═══════════════════════════════════════════════
   RESPONSIVE — Tablet
   ═══════════════════════════════════════════════ */
@media (max-width: 960px) {
  .login-card { grid-template-columns: 1fr; }
  .login-hero { padding: 22px; }
  .hero-visual { height: 200px; }
}

/* ═══════════════════════════════════════════════
   RESPONSIVE — Mobile (≤768px)
   ═══════════════════════════════════════════════ */
@media (max-width: 768px) {
  body { overflow-x: hidden; }

  .app-shell { padding: 0; overflow: hidden; }

  .app-topbar {
    height: auto; padding: 12px 16px 10px; margin-bottom: 0;
    border-bottom: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px); flex-shrink: 0;
  }
  .brand .eyebrow { display: none; }
  .brand h1       { font-size: 1.2rem; }
  .brand-logo     { width: 34px; height: 34px; }
  .network-pill   { padding: 6px 10px; font-size: 0.75rem; }
  #connectionLabel { display: none; }

  .login-card {
    grid-template-columns: 1fr; gap: 0; border-radius: 0;
    border-left: none; border-right: none; border-bottom: none;
    padding: 0; margin-top: 0; box-shadow: none; background: transparent; backdrop-filter: none;
  }
  .login-hero { display: none; }
  .login-panel { border-radius: 0; border: none; background: transparent; padding: 28px 20px 32px; gap: 16px; }
  .login-panel h3  { font-size: 1.65rem; font-weight: 800; }
  .login-panel > p { font-size: 0.85rem; }
  #loginForm button { padding: 15px; font-size: 1rem; }

  .chat-layout { display: block; position: relative; flex: 1; height: 0; overflow: hidden; }

  .sidebar, .chat {
    position: absolute; inset: 0; width: 100%; height: 100%;
    border-radius: 0; border: none; box-shadow: none;
    background: var(--mob-bg); backdrop-filter: none;
    transition: transform 0.28s cubic-bezier(0.4,0,0.2,1), opacity 0.28s ease;
    will-change: transform;
  }

  .sidebar {
    display: grid; grid-template-rows: auto auto auto 1fr;
    gap: 0; padding: 16px 16px 20px; overflow-y: auto;
    transform: translateX(0); opacity: 1; z-index: 2;
  }
  .sidebar > * + * { margin-top: 12px; }

  .chat {
    display: grid; grid-template-rows: auto 1fr auto auto;
    gap: 0; padding: 0;
    transform: translateX(100%); opacity: 0; z-index: 1;
  }
  .sidebar[data-mob-hidden] { transform: translateX(-100%); opacity: 0; pointer-events: none; }
  .chat:not([data-mob-hidden]) { transform: translateX(0); opacity: 1; z-index: 2; }

  .me-row { border-radius: var(--r2); padding: 12px 14px; }
  .add-friend-form { grid-template-columns: 1fr auto; }
  .list-panel:not(.friends-panel) { max-height: 150px; }
  .friends-panel { min-height: 0; max-height: none; flex: 1; }

  .chat-header {
    border-radius: 0; border: none; border-bottom: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px);
    padding: 12px 14px; gap: 10px;
  }
  .chat-header h2   { font-size: 1.05rem; }
  .chat-header .eyebrow { display: none; }

  .mob-back-btn {
    display: flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 50%;
    border: 1px solid var(--b1); background: rgba(255,255,255,0.05);
    color: var(--cyan); cursor: pointer; padding: 0; box-shadow: none; flex-shrink: 0;
    transition: background 0.15s;
  }
  .mob-back-btn:hover { background: rgba(0,229,255,0.08); transform: none; filter: none; box-shadow: none; }
  :root.light .mob-back-btn { color: #0070a8; background: rgba(0,0,0,0.04); }

  .messages-wrap { flex: 1; min-height: 0; }
  .messages { padding: 12px 14px; gap: 10px; }
  .message { max-width: 86%; }
  .typing-indicator { padding: 0 14px; }

  .message-form-wrap { flex-shrink: 0; }
  .message-form {
    border-radius: 0; border: none; border-top: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px);
    padding: 10px 12px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
  }
  .message-form input  { font-size: 1rem; padding: 10px 12px; border-radius: var(--r2); }
  .message-form button { padding: 0 16px; min-width: 68px; height: 44px; border-radius: var(--r2); font-size: 0; }
  .message-form button svg { width: 18px; height: 18px; }

  .char-counter { padding: 0 14px 6px; }
  .mini-stat { font-size: 0.7rem; padding: 4px 10px; }
  .toast { right: 12px; left: 12px; max-width: none; bottom: calc(16px + env(safe-area-inset-bottom, 0px)); }
  #requestList { max-height: 130px; }
  .scroll-btn { bottom: 16px; right: 16px; }
}

/* ═══════════════════════════════════════════════
   HERO CHAT MOCKUP
   ═══════════════════════════════════════════════ */
.hero-mock {
  position: absolute; inset: 0;
  display: flex; flex-direction: column;
  padding: 14px;
  gap: 10px;
}

.mock-header {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px;
  border-radius: var(--r2);
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.08);
  flex-shrink: 0;
}
:root.light .mock-header { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.06); }

.mock-avatar {
  width: 30px; height: 30px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.72rem; font-weight: 800; color: #fff; flex-shrink: 0;
}
.mock-name { font-size: 0.82rem; font-weight: 700; color: var(--t1); line-height: 1.2; }
.mock-status {
  display: flex; align-items: center; gap: 5px;
  font-size: 0.68rem; font-weight: 600; color: var(--online);
}
.mock-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: var(--online); box-shadow: 0 0 6px var(--online);
}

.mock-messages {
  display: flex; flex-direction: column; gap: 8px;
  flex: 1; overflow: hidden;
}

.mock-msg { display: flex; flex-direction: column; gap: 2px; }
.mock-them { align-items: flex-start; }
.mock-me   { align-items: flex-end; }

.mock-bubble {
  padding: 8px 12px; border-radius: 12px;
  font-size: 0.78rem; font-weight: 500; line-height: 1.45;
  max-width: 86%;
}
.mock-them .mock-bubble {
  background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.08);
  color: var(--t1); border-bottom-left-radius: 3px;
}
.mock-me .mock-bubble {
  background: linear-gradient(145deg, rgba(0,229,255,0.14), rgba(124,58,237,0.16));
  border: 1px solid rgba(0,229,255,0.20); color: var(--t1);
  border-bottom-right-radius: 3px;
}
:root.light .mock-them .mock-bubble { background: rgba(255,255,255,0.85); border-color: rgba(0,0,0,0.08); }
:root.light .mock-me   .mock-bubble { border-color: rgba(0,112,168,0.22); }

.mock-time {
  font-size: 0.62rem; font-weight: 600; color: var(--t3);
  padding: 0 4px;
}
.mock-me .mock-time { text-align: right; }

.mock-reaction-row {
  display: inline-flex; align-items: center; gap: 3px;
  background: rgba(0,229,255,0.10); border: 1px solid rgba(0,229,255,0.22);
  border-radius: var(--rp); padding: 1px 7px;
  font-size: 0.7rem; font-weight: 700; color: var(--cyan);
  margin-bottom: 4px; margin-right: 4px;
}
:root.light .mock-reaction-row { background: rgba(0,112,168,0.10); border-color: rgba(0,112,168,0.22); color: #0070a8; }

.mock-typing {
  display: flex; align-items: center; gap: 8px; margin-top: 2px;
}
.mock-avatar-sm {
  width: 22px; height: 22px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.6rem; font-weight: 800; color: #fff; flex-shrink: 0;
}
.mock-dots {
  display: flex; gap: 4px; align-items: center;
  background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--rp); padding: 7px 12px;
}
:root.light .mock-dots { background: rgba(255,255,255,0.85); border-color: rgba(0,0,0,0.08); }
.mock-dots span {
  width: 5px; height: 5px; border-radius: 50%; background: var(--cyan); opacity: 0.5;
  animation: typingBounce 1.1s ease-in-out infinite;
}
.mock-dots span:nth-child(2) { animation-delay: 0.18s; }
.mock-dots span:nth-child(3) { animation-delay: 0.36s; }

/* Login panel logo */
.login-panel-logo {
  margin-bottom: -4px;
}

/* ═══════════════════════════════════════════════
   LOGOUT BUTTON
   ═══════════════════════════════════════════════ */
.logout-btn {
  display: flex; align-items: center; justify-content: center;
  width: 34px; height: 34px; border-radius: 50%;
  border: 1px solid var(--b1);
  background: rgba(255,77,109,0.07);
  color: rgba(255,77,109,0.70);
  cursor: pointer; padding: 0;
  box-shadow: none; flex-shrink: 0;
  transition: background 0.18s, color 0.18s, border-color 0.18s, transform 0.15s;
}
.logout-btn:hover {
  background: rgba(255,77,109,0.14);
  border-color: rgba(255,77,109,0.32);
  color: var(--danger);
  transform: none; filter: none;
  box-shadow: 0 0 12px rgba(255,77,109,0.18);
}
:root.light .logout-btn { background: rgba(255,77,109,0.05); }

/* ═══════════════════════════════════════════════
   ANIMATION BUG FIX — suppress anim on history
   ═══════════════════════════════════════════════ */
.message.no-anim { animation: none !important; }

/* ═══════════════════════════════════════════════
   REACTION PICKER — fixed to body, not clipped
   ═══════════════════════════════════════════════ */
/* When picker is appended to body with fixed positioning */
.reaction-picker {
  background: var(--panel-bg);
  border: 1px solid var(--b1); border-radius: var(--r2);
  padding: 6px 8px; display: flex; gap: 4px;
  box-shadow: var(--s2); backdrop-filter: blur(16px);
  animation: fadeUp 0.15s ease;
}
.reaction-picker button {
  background: none; border: none; padding: 4px 5px;
  font-size: 1.1rem; border-radius: 6px; box-shadow: none;
  cursor: pointer; transition: background 0.12s, transform 0.12s;
}
.reaction-picker button:hover {
  background: rgba(255,255,255,0.10);
  transform: scale(1.25); filter: none; box-shadow: none;
}
:root.light .reaction-picker button:hover { background: rgba(0,0,0,0.06); }

/* ═══════════════════════════════════════════════
   ME-ROW — updated for logout button
   ═══════════════════════════════════════════════ */
/* Override presence-pill hide — logout replaces it */
.me-row .presence-pill { display: none; }
/* ══════════════════════════════════════════════════════════════
   NOVYN EXTRAS — Reply, Reactions, Snap Typing, Profile Modal
   ══════════════════════════════════════════════════════════════ */

/* ── Snap-style typing indicator ────────────────────────────── */
.typing-indicator {
  display: flex !important;
  align-items: center;
  gap: 10px;
  padding: 4px 18px 8px;
  min-height: 40px;
}
.snap-typing-bubble {
  display: flex;
  align-items: center;
  gap: 5px;
  background: var(--msg-them-bg);
  border: 1px solid var(--msg-them-bdr);
  border-radius: 20px;
  padding: 8px 14px;
  box-shadow: var(--s1);
  animation: snapBubbleIn 0.25s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes snapBubbleIn {
  from { transform: scale(0.6) translateY(6px); opacity: 0; }
  to   { transform: scale(1)   translateY(0);   opacity: 1; }
}
.snap-dot {
  display: block;
  width: 9px; height: 9px;
  border-radius: 50%;
  background: var(--cyan);
  opacity: 0.35;
  animation: snapPulse 1.1s cubic-bezier(0.45,0.05,0.55,0.95) infinite;
}
.snap-dot:nth-child(1) { animation-delay: 0s; }
.snap-dot:nth-child(2) { animation-delay: 0.18s; }
.snap-dot:nth-child(3) { animation-delay: 0.36s; }
@keyframes snapPulse {
  0%,100% { transform: scale(0.65); opacity: 0.28; }
  40%     { transform: scale(1.25); opacity: 1; background: var(--cyan); }
  60%     { transform: scale(1.1);  opacity: 0.85; }
}
.snap-typing-label { font-size: 0.72rem; color: var(--t2); letter-spacing: 0.01em; }
:root.light .snap-dot { background: var(--violet); }

/* ── Message action buttons (reply + react) ─────────────────── */
.msg-actions { display: flex; gap: 2px; }

/* ── Reply banner above input ───────────────────────────────── */
.reply-banner {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 12px;
  background: rgba(0,229,255,0.08);
  border-left: 3px solid var(--cyan);
  font-size: 0.78rem; color: var(--t2);
  border-radius: 6px 6px 0 0;
  margin: 0 12px;
}
.reply-banner.hidden { display: none; }
.reply-preview-text { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.reply-cancel-btn {
  background: none; border: none; color: var(--t2);
  cursor: pointer; font-size: 0.9rem; padding: 0 4px;
  border-radius: 4px; transition: color 0.15s; line-height: 1;
}
.reply-cancel-btn:hover { color: var(--t1); }

/* ── Reply quote inside message bubble ──────────────────────── */
.reply-quote {
  display: flex; flex-direction: column; gap: 1px;
  background: rgba(0,0,0,0.18);
  border-left: 3px solid rgba(255,255,255,0.35);
  border-radius: 4px; padding: 4px 8px;
  margin-bottom: 5px; cursor: pointer;
  transition: background 0.15s; max-width: 100%;
}
.reply-quote:hover { background: rgba(0,0,0,0.26); }
.reply-quote-author { font-size: 0.7rem; font-weight: 600; color: rgba(255,255,255,0.75); }
.reply-quote-text { font-size: 0.75rem; color: rgba(255,255,255,0.55); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.message.them .reply-quote { border-left-color: rgba(0,0,0,0.2); background: rgba(0,0,0,0.06); }
.message.them .reply-quote-author { color: rgba(0,0,0,0.55); }
.message.them .reply-quote-text { color: rgba(0,0,0,0.4); }

/* ── Highlight flash when jumping to quoted message ─────────── */
@keyframes highlightFlash {
  0%   { outline: 2px solid var(--cyan); outline-offset: 2px; }
  60%  { outline: 2px solid var(--cyan); outline-offset: 2px; }
  100% { outline: 2px solid transparent; outline-offset: 2px; }
}
.message.highlight-flash { animation: highlightFlash 1.2s ease forwards; }

/* ── Profile button in me-row ───────────────────────────────── */
.me-row-btns { display: flex; align-items: center; gap: 6px; }
.profile-btn {
  display: flex; align-items: center; justify-content: center;
  width: 32px; height: 32px; border-radius: 50%; border: none;
  background: rgba(0,229,255,0.08); color: var(--cyan);
  cursor: pointer; transition: background 0.2s, transform 0.15s; flex-shrink: 0;
}
.profile-btn:hover { background: rgba(0,229,255,0.18); transform: scale(1.1); }
:root.light .profile-btn { background: rgba(99,102,241,0.08); color: var(--violet); }
:root.light .profile-btn:hover { background: rgba(99,102,241,0.16); }

/* ── Profile Modal ──────────────────────────────────────────── */
.profile-modal {
  position: fixed; inset: 0; z-index: 1000;
  align-items: center; justify-content: center;
  /* display controlled via style attr, not class */
}
.profile-modal-backdrop {
  position: absolute; inset: 0;
  background: rgba(0,0,0,0.62); backdrop-filter: blur(6px);
}
.profile-modal-card {
  position: relative; z-index: 1;
  width: min(480px, 94vw); max-height: 88vh; overflow-y: auto;
  background: var(--panel-bg); border: 1px solid var(--card-border);
  border-radius: var(--r3); box-shadow: var(--s3);
  padding: 28px 24px 24px;
  display: flex; flex-direction: column; gap: 20px;
  animation: modalSlideUp 0.28s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes modalSlideUp {
  from { transform: translateY(32px) scale(0.96); opacity: 0; }
  to   { transform: translateY(0)    scale(1);    opacity: 1; }
}
.profile-modal-header {
  display: flex; align-items: center; justify-content: space-between;
}
.profile-modal-header h3 { font-size: 1.15rem; font-weight: 700; color: var(--t1); margin: 0; }
.profile-modal-close {
  background: var(--b1); border: none; border-radius: 50%;
  width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--t2); transition: background 0.15s, color 0.15s, transform 0.15s;
}
.profile-modal-close:hover { background: var(--b2); color: var(--t1); transform: rotate(90deg); }

.profile-avatar-preview { display: flex; flex-direction: column; align-items: center; gap: 6px; }
.profile-avatar-big {
  width: 80px; height: 80px; border-radius: 50%;
  background: var(--g-brand); display: flex; align-items: center; justify-content: center;
  font-size: 2.2rem; border: 3px solid var(--card-border); box-shadow: var(--s2);
  transition: background 0.3s; user-select: none;
}
.profile-avatar-hint { font-size: 0.73rem; color: var(--t3); }

.profile-avatar-grid {
  display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;
}
@media (max-width: 400px) { .profile-avatar-grid { grid-template-columns: repeat(4, 1fr); } }

.av-grid-btn {
  aspect-ratio: 1; border-radius: 12px; border: 2px solid transparent;
  cursor: pointer; font-size: 1.4rem;
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.15s, border-color 0.15s, box-shadow 0.15s;
  box-shadow: var(--s1);
}
.av-grid-btn:hover { transform: scale(1.12); box-shadow: 0 4px 16px rgba(0,0,0,0.4); }
.av-grid-btn.selected { border-color: var(--cyan); box-shadow: 0 0 0 3px rgba(0,229,255,0.3); transform: scale(1.08); }
:root.light .av-grid-btn.selected { border-color: var(--violet); box-shadow: 0 0 0 3px rgba(124,58,237,0.25); }

.profile-fields { display: flex; flex-direction: column; gap: 14px; }
.profile-field { display: flex; flex-direction: column; gap: 5px; flex: 1; }
.profile-field label {
  font-size: 0.73rem; font-weight: 600; color: var(--t2);
  letter-spacing: 0.04em; text-transform: uppercase;
}
.profile-field input, .profile-field select {
  background: var(--input-bg); border: 1px solid var(--input-border);
  border-radius: var(--r1); padding: 9px 12px;
  color: var(--t1); font-size: 0.9rem; font-family: inherit;
  transition: border-color 0.2s, box-shadow 0.2s;
  outline: none; width: 100%; box-sizing: border-box;
}
.profile-field input:focus, .profile-field select:focus {
  border-color: var(--cyan); box-shadow: 0 0 0 2px rgba(0,229,255,0.15);
}
:root.light .profile-field input:focus, :root.light .profile-field select:focus {
  border-color: var(--violet); box-shadow: 0 0 0 2px rgba(124,58,237,0.12);
}
.profile-field select option { background: #1a1f35; color: #eef2f8; }
:root.light .profile-field select option { background: #fff; color: #0d1120; }

.profile-save-btn {
  width: 100%; padding: 11px; border-radius: var(--r2);
  border: none; background: var(--g-brand); color: #fff;
  font-weight: 700; font-size: 0.95rem; font-family: inherit;
  cursor: pointer; letter-spacing: 0.03em;
  transition: opacity 0.2s, transform 0.15s, box-shadow 0.2s;
  box-shadow: var(--glow-c);
}
.profile-save-btn:hover { opacity: 0.88; transform: translateY(-1px); box-shadow: 0 6px 22px rgba(0,229,255,0.3); }

.profile-modal-card::-webkit-scrollbar { width: 4px; }
.profile-modal-card::-webkit-scrollbar-thumb { background: var(--b2); border-radius: 4px; }

/* Override presence-pill hide — logout/profile replace it */
.me-row .presence-pill { display: none; }