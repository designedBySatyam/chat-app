/* ═══════════════════════════════════════════════════════════════
   Novyn — Liquid Glass Noir  v4
   Fonts: DM Sans (body) + DM Serif Display (hero headline)
   ═══════════════════════════════════════════════════════════════ */

/* ── Dark theme (default) ──────────────────────── */
:root {
  /* Backgrounds */
  --bg-void:       #07050f;
  --bg-surface:    rgba(255,255,255,0.038);
  --bg-surface-2:  rgba(255,255,255,0.065);

  /* Brand palette — violet/rose instead of cyan */
  --violet:  #a78bfa;
  --violet-d:#7c3aed;
  --rose:    #f472b6;
  --rose-d:  #ec4899;
  --amber:   #fbbf24;
  --emerald: #34d399;
  --danger:  #f87171;
  --online:  #34d399;

  /* Text */
  --t1: #f0eeff;
  --t2: rgba(220,210,255,0.60);
  --t3: rgba(200,190,240,0.36);

  /* Borders / surfaces */
  --b1: rgba(255,255,255,0.07);
  --b2: rgba(255,255,255,0.11);
  --b3: rgba(167,139,250,0.18);

  /* Gradients */
  --g-brand:   linear-gradient(135deg, #a78bfa 0%, #ec4899 100%);
  --g-brand-r: linear-gradient(135deg, #ec4899 0%, #a78bfa 100%);
  --g-send:    linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
  --g-warm:    linear-gradient(135deg, #a78bfa 0%, #f472b6 50%, #fb923c 100%);
  --g-me-msg:  linear-gradient(145deg, rgba(167,139,250,0.13), rgba(236,72,153,0.10));
  --g-glass:   linear-gradient(145deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02));

  /* Glows */
  --glow-brand: 0 0 28px rgba(167,139,250,0.22);
  --glow-ok:    0 0 14px rgba(52,211,153,0.22);
  --glow-rose:  0 0 20px rgba(244,114,182,0.18);

  /* Shadows */
  --s1: 0 2px 8px  rgba(0,0,0,0.50);
  --s2: 0 8px 28px rgba(0,0,0,0.58);
  --s3: 0 24px 80px rgba(0,0,0,0.75);

  /* Card */
  --card-bg:      rgba(255,255,255,0.038);
  --card-border:  rgba(255,255,255,0.07);
  --input-bg:     rgba(255,255,255,0.05);
  --input-border: rgba(255,255,255,0.09);
  --hero-bg:      rgba(6,4,18,0.92);
  --panel-bg:     rgba(8,5,22,0.90);
  --msg-them-bg:  rgba(255,255,255,0.055);
  --msg-them-bdr: rgba(255,255,255,0.08);
  --mob-bg:       #07050f;
  --mob-bar-bg:   rgba(7,5,15,0.92);

  /* Radii */
  --r1: 8px; --r2: 14px; --r3: 20px; --r4: 28px; --rp: 999px;

  /* Layout */
  --sidebar-w: 310px;
  --topbar-h:  68px;

  /* Toggle */
  --toggle-track: rgba(255,255,255,0.09);
  --toggle-thumb: #fff;
}

/* ── Light theme ────────────────────────────────── */
:root.light {
  --bg-void:       #f4f0ff;
  --bg-surface:    rgba(255,255,255,0.75);
  --bg-surface-2:  rgba(255,255,255,0.92);

  --t1: #140d2e;
  --t2: rgba(30,15,70,0.62);
  --t3: rgba(30,15,70,0.36);

  --b1: rgba(0,0,0,0.07);
  --b2: rgba(0,0,0,0.11);
  --b3: rgba(124,58,237,0.16);

  --glow-brand: 0 0 20px rgba(124,58,237,0.15);
  --glow-ok:    0 0 14px rgba(16,185,129,0.15);
  --glow-rose:  0 0 16px rgba(219,39,119,0.12);

  --s1: 0 2px 8px  rgba(0,0,0,0.07);
  --s2: 0 8px 28px rgba(0,0,0,0.10);
  --s3: 0 24px 72px rgba(0,0,0,0.14);

  --card-bg:      rgba(255,255,255,0.82);
  --card-border:  rgba(0,0,0,0.06);
  --input-bg:     rgba(0,0,0,0.04);
  --input-border: rgba(0,0,0,0.09);
  --hero-bg:      rgba(238,233,255,0.96);
  --panel-bg:     rgba(255,255,255,0.94);
  --msg-them-bg:  rgba(255,255,255,0.92);
  --msg-them-bdr: rgba(0,0,0,0.06);
  --mob-bg:       #f4f0ff;
  --mob-bar-bg:   rgba(244,240,255,0.94);

  --toggle-track: rgba(0,0,0,0.10);
  --toggle-thumb: #fff;
}

/* ── Theme transitions ──────────────────────────── */
body,
.card, .sidebar, .chat, .me-row, .chat-header,
.message-form, .app-topbar, .login-hero, .login-panel,
input, .item-card, .friend-btn, .toast {
  transition:
    background 0.38s ease,
    border-color 0.38s ease,
    color 0.38s ease,
    box-shadow 0.38s ease;
}

/* ═══ Reset ══════════════════════════════════════ */
*, *::before, *::after { box-sizing: border-box; }
html { height: 100%; }
body { height: 100%; margin: 0; }
h1,h2,h3,h4,p { margin: 0; }
ul { margin: 0; padding: 0; list-style: none; }

/* ═══ Base ═══════════════════════════════════════ */
body {
  font-family: 'DM Sans', system-ui, sans-serif;
  font-size: 14.5px;
  line-height: 1.55;
  color: var(--t1);
  background: var(--bg-void);
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
  display: flex;
  flex-direction: column;
}
h1,h2,h3 { letter-spacing: -0.02em; font-weight: 700; }

/* ═══ Ambient blobs ══════════════════════════════ */
.bg-shape {
  position: fixed; z-index: 0;
  pointer-events: none;
  border-radius: 50%;
  filter: blur(100px);
  animation: driftBlob 28s ease-in-out infinite;
}
.bg-shape-one {
  width: 75vw; height: 75vw; max-width: 850px; max-height: 850px;
  top: -28%; left: -18%;
  background: radial-gradient(circle, rgba(124,58,237,0.18) 0%, rgba(167,139,250,0.08) 50%, transparent 100%);
}
.bg-shape-two {
  width: 65vw; height: 65vw; max-width: 750px; max-height: 750px;
  bottom: -22%; right: -16%;
  background: radial-gradient(circle, rgba(236,72,153,0.15) 0%, rgba(167,139,250,0.07) 50%, transparent 100%);
  animation-delay: -11s; animation-direction: reverse;
}
.bg-shape-three {
  width: 40vw; height: 40vw; max-width: 500px; max-height: 500px;
  top: 40%; left: 40%;
  background: radial-gradient(circle, rgba(251,191,36,0.06) 0%, transparent 70%);
  animation-delay: -6s;
}

:root.light .bg-shape-one {
  background: radial-gradient(circle, rgba(124,58,237,0.10) 0%, transparent 70%);
}
:root.light .bg-shape-two {
  background: radial-gradient(circle, rgba(236,72,153,0.08) 0%, transparent 70%);
}
:root.light .bg-shape-three { opacity: 0.4; }

.grain-layer {
  position: fixed; inset: 0; z-index: 0; pointer-events: none; opacity: 0.025;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='300' height='300' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
  background-size: 250px 250px;
}

/* ═══ App shell ══════════════════════════════════ */
.app-shell {
  position: relative; z-index: 1;
  display: flex; flex-direction: column;
  flex: 1; min-height: 0;
  max-width: 1360px; width: 100%;
  margin: 0 auto;
  padding: 20px clamp(14px, 2.8vw, 32px) 24px;
  overflow: hidden;
}

/* ═══ Top bar ════════════════════════════════════ */
.app-topbar {
  display: flex; justify-content: space-between; align-items: center;
  gap: 12px; height: var(--topbar-h); flex-shrink: 0; margin-bottom: 16px;
}

.topbar-right {
  display: flex; align-items: center; gap: 10px;
}

/* ── Brand ────────────────────────────────────── */
.brand { display: flex; align-items: center; gap: 13px; }

.brand-logo {
  flex-shrink: 0;
  width: 42px; height: 42px;
}
.brand-logo-ring {
  transform-origin: 50% 50%;
  animation: logoRipple 3s ease-out infinite;
}
.brand-logo-ring:nth-child(2) { animation-delay: 1s; }
.brand-logo-ring:nth-child(3) { animation-delay: 2s; }

.eyebrow {
  font-size: 0.62rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.15em;
  color: var(--t3);
}
.brand .eyebrow { color: rgba(167,139,250,0.65); }
:root.light .brand .eyebrow { color: rgba(109,40,217,0.7); }

.brand h1 {
  font-size: clamp(1.28rem, 2vw, 1.72rem); font-weight: 800;
  background: var(--g-brand);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; letter-spacing: -0.04em; margin-top: 1px;
}

/* ── Network pill ─────────────────────────────── */
.network-pill {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 7px 14px; border-radius: var(--rp);
  border: 1px solid var(--b1); background: var(--bg-surface);
  backdrop-filter: blur(16px);
  font-size: 0.78rem; font-weight: 600; color: var(--t2);
  transition: border-color 0.35s, color 0.35s, box-shadow 0.35s;
}
.network-pill.connected {
  border-color: rgba(52,211,153,0.28);
  color: var(--emerald);
  box-shadow: var(--glow-ok);
}
.network-pill.offline {
  border-color: rgba(248,113,113,0.28);
  color: var(--danger);
}

.signal-dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: var(--t3); flex-shrink: 0;
}
.network-pill.connected .signal-dot {
  background: var(--emerald);
  box-shadow: 0 0 0 3px rgba(52,211,153,0.2);
  animation: pulseDot 2.4s ease-in-out infinite;
}
.network-pill.offline .signal-dot {
  background: var(--danger);
  box-shadow: 0 0 0 3px rgba(248,113,113,0.15);
}

/* ── Theme toggle ─────────────────────────────── */
.theme-toggle {
  position: relative;
  width: 52px; height: 28px;
  border-radius: var(--rp);
  border: 1px solid var(--b2);
  background: var(--toggle-track);
  cursor: pointer;
  flex-shrink: 0;
  padding: 0;
  box-shadow: none;
  transition: background 0.4s, border-color 0.4s;
  overflow: visible;
}
.theme-toggle:hover { transform: none; filter: none; box-shadow: none; }

.theme-toggle-thumb {
  position: absolute;
  top: 3px; left: 3px;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: var(--toggle-thumb);
  box-shadow: 0 1px 4px rgba(0,0,0,0.35);
  transition: left 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), background 0.35s;
  display: flex; align-items: center; justify-content: center;
  overflow: hidden;
}
:root.light .theme-toggle-thumb { left: 27px; }

.icon-moon, .icon-sun {
  position: absolute;
  width: 12px; height: 12px;
  transition: opacity 0.25s, transform 0.35s;
}
.icon-moon { opacity: 1; transform: rotate(0deg); }
.icon-sun  { opacity: 0; transform: rotate(90deg); }
:root.light .icon-moon { opacity: 0; transform: rotate(-90deg); }
:root.light .icon-sun  { opacity: 1; transform: rotate(0deg); }

:root.light .theme-toggle {
  background: rgba(251,191,36,0.16);
  border-color: rgba(251,191,36,0.32);
  box-shadow: 0 0 12px rgba(251,191,36,0.18);
}

/* ═══ Card base ══════════════════════════════════ */
.card {
  border: 1px solid var(--card-border);
  border-radius: var(--r4);
  background: var(--card-bg);
  backdrop-filter: blur(24px) saturate(1.6);
  box-shadow: var(--s3), inset 0 1px 0 rgba(255,255,255,0.05);
}
:root.light .card {
  box-shadow: var(--s2), inset 0 1px 0 rgba(255,255,255,0.95);
}

.hidden { display: none !important; }

/* ═══════════════════════════════════════════════
   LOGIN PAGE — Redesigned
   ═══════════════════════════════════════════════ */
.login-card {
  display: grid;
  grid-template-columns: 1.3fr 1fr;
  gap: 16px; padding: 16px;
  animation: fadeUp 0.55s cubic-bezier(0.22, 1, 0.36, 1);
  align-self: start; margin-top: 4px;
}

/* ── Hero panel ─────────────────────────────────── */
.login-hero {
  position: relative; display: flex; flex-direction: column; gap: 22px;
  border-radius: var(--r3);
  border: 1px solid rgba(167,139,250,0.14);
  background:
    radial-gradient(ellipse 70% 50% at 10% -5%, rgba(124,58,237,0.18) 0%, transparent 60%),
    radial-gradient(ellipse 50% 60% at 90% 110%, rgba(236,72,153,0.14) 0%, transparent 60%),
    var(--hero-bg);
  padding: clamp(24px, 3vw, 36px);
  overflow: hidden;
}
:root.light .login-hero {
  border-color: rgba(124,58,237,0.12);
}

/* Top shimmer line */
.login-hero::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 1px;
  background: linear-gradient(90deg, transparent 0%, rgba(167,139,250,0.6) 40%, rgba(244,114,182,0.5) 70%, transparent 100%);
}
:root.light .login-hero::before {
  background: linear-gradient(90deg, transparent 0%, rgba(124,58,237,0.35) 50%, transparent 100%);
}

/* Decorative orbs */
.hero-orb {
  position: absolute; border-radius: 50%; pointer-events: none;
  filter: blur(60px);
}
.hero-orb-1 {
  width: 220px; height: 220px;
  top: -60px; right: -40px;
  background: radial-gradient(circle, rgba(167,139,250,0.22) 0%, transparent 70%);
  animation: orbFloat 8s ease-in-out infinite;
}
.hero-orb-2 {
  width: 180px; height: 180px;
  bottom: -30px; left: 20px;
  background: radial-gradient(circle, rgba(236,72,153,0.18) 0%, transparent 70%);
  animation: orbFloat 10s ease-in-out infinite reverse;
  animation-delay: -4s;
}

/* Hero top section */
.hero-top { position: relative; z-index: 1; }
.hero-eyebrow {
  font-size: 0.64rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.18em;
  color: var(--violet); opacity: 0.9;
  margin-bottom: 12px;
  display: flex; align-items: center; gap: 6px;
}
:root.light .hero-eyebrow { color: var(--violet-d); }

.hero-headline {
  font-family: 'DM Serif Display', serif;
  font-size: clamp(2.4rem, 4.5vw, 3.4rem);
  font-weight: 400;
  line-height: 1.0;
  letter-spacing: -0.03em;
  color: var(--t1);
  margin-bottom: 14px;
}
.hero-headline em {
  font-style: italic;
  background: var(--g-brand);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
:root.light .hero-headline { color: #0d0820; }

.hero-sub {
  font-size: 0.95rem; line-height: 1.65;
  color: var(--t2); max-width: 42ch;
}

/* ── Mock chat preview ─────────────────────────── */
.hero-chat-preview {
  position: relative; z-index: 1;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.09);
  background: rgba(255,255,255,0.03);
  backdrop-filter: blur(12px);
  overflow: hidden;
  box-shadow: var(--s2), inset 0 1px 0 rgba(255,255,255,0.06);
}
:root.light .hero-chat-preview {
  background: rgba(255,255,255,0.70);
  border-color: rgba(0,0,0,0.07);
  box-shadow: var(--s1), inset 0 1px 0 rgba(255,255,255,0.9);
}

/* Preview top bar */
.hcp-bar {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.025);
}
:root.light .hcp-bar {
  border-color: rgba(0,0,0,0.06);
  background: rgba(255,255,255,0.5);
}

.hcp-avatar {
  width: 30px; height: 30px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.95rem; flex-shrink: 0;
}
.hcp-av-a {
  background: linear-gradient(135deg, #f7971e, #ffd200);
}

.hcp-bar-info { display: flex; flex-direction: column; gap: 1px; }
.hcp-name { font-size: 0.82rem; font-weight: 700; color: var(--t1); }
.hcp-presence { font-size: 0.68rem; font-weight: 600; color: var(--emerald); }

/* Preview messages */
.hcp-messages {
  padding: 12px 14px; display: flex; flex-direction: column; gap: 7px;
}

.hcp-msg { display: flex; flex-direction: column; gap: 2px; }
.hcp-msg.hcp-me { align-items: flex-end; }
.hcp-msg.hcp-them { align-items: flex-start; }

.hcp-bubble {
  display: inline-block;
  padding: 7px 11px;
  border-radius: 14px;
  font-size: 0.8rem; font-weight: 500;
  max-width: 82%;
  line-height: 1.45;
}
.hcp-them .hcp-bubble {
  background: var(--msg-them-bg);
  border: 1px solid var(--msg-them-bdr);
  border-bottom-left-radius: 4px;
  color: var(--t1);
}
.hcp-me .hcp-bubble {
  background: var(--g-me-msg);
  border: 1px solid rgba(167,139,250,0.18);
  border-bottom-right-radius: 4px;
  color: var(--t1);
}
:root.light .hcp-me .hcp-bubble {
  border-color: rgba(124,58,237,0.20);
}

.hcp-time {
  font-size: 0.62rem; color: var(--t3); font-weight: 500;
  padding: 0 2px;
}

.hcp-reaction-row {
  display: flex; gap: 5px; padding-left: 2px;
}
.hcp-reaction {
  display: inline-flex; align-items: center; gap: 3px;
  padding: 2px 8px; border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.06);
  font-size: 0.72rem; color: var(--t2);
}
.hcp-reaction-mine {
  border-color: rgba(167,139,250,0.28);
  background: rgba(167,139,250,0.10);
  color: var(--violet);
}
:root.light .hcp-reaction { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }
:root.light .hcp-reaction-mine { background: rgba(124,58,237,0.08); border-color: rgba(124,58,237,0.22); color: var(--violet-d); }

/* Typing animation in preview */
.hcp-typing {
  display: flex; align-items: center; gap: 8px;
  padding: 4px 14px 10px;
}
.hcp-typing-dots {
  display: flex; align-items: center; gap: 3px;
  padding: 6px 10px; border-radius: 20px;
  background: var(--msg-them-bg);
  border: 1px solid var(--msg-them-bdr);
}
.hcp-typing-dots span {
  display: block; width: 5px; height: 5px; border-radius: 50%;
  background: var(--violet);
  animation: hcpDot 1.2s ease-in-out infinite;
}
.hcp-typing-dots span:nth-child(2) { animation-delay: 0.18s; }
.hcp-typing-dots span:nth-child(3) { animation-delay: 0.36s; }
@keyframes hcpDot {
  0%,60%,100% { transform: scale(0.6); opacity: 0.35; }
  30%          { transform: scale(1.2); opacity: 1; }
}

.hcp-typing-label { font-size: 0.7rem; color: var(--t3); }

/* ── Feature pills ──────────────────────────────── */
.hero-pills {
  display: flex; flex-wrap: wrap; gap: 8px;
  position: relative; z-index: 1;
}
.hero-pill {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 6px 13px; border-radius: var(--rp);
  border: 1px solid rgba(167,139,250,0.18);
  background: rgba(167,139,250,0.07);
  font-size: 0.77rem; font-weight: 600; color: var(--t2);
  backdrop-filter: blur(8px);
  transition: background 0.2s, border-color 0.2s, color 0.2s;
}
.hero-pill:hover {
  background: rgba(167,139,250,0.14);
  border-color: rgba(167,139,250,0.32);
  color: var(--violet);
}
:root.light .hero-pill {
  border-color: rgba(124,58,237,0.16);
  background: rgba(124,58,237,0.05);
  color: var(--t2);
}
:root.light .hero-pill:hover {
  background: rgba(124,58,237,0.10);
  color: var(--violet-d);
}

/* ── Login panel ─────────────────────────────────── */
.login-panel {
  display: flex; flex-direction: column; gap: 20px;
  border-radius: var(--r3); border: 1px solid var(--card-border);
  background: var(--panel-bg);
  padding: clamp(24px, 3vw, 34px);
  justify-content: center;
}

/* Login panel header */
.login-panel-header {
  display: flex; align-items: flex-start; gap: 14px;
}
.login-logo-mark { flex-shrink: 0; }
.login-panel-header h3 {
  font-size: 1.45rem; font-weight: 800;
  color: var(--t1); margin-bottom: 4px;
}
.login-panel-sub {
  color: var(--t2); font-size: 0.85rem; line-height: 1.55;
}

/* Input groups */
#loginForm { display: flex; flex-direction: column; gap: 14px; }

.input-group { display: flex; flex-direction: column; gap: 6px; }
.input-label {
  font-size: 0.72rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.10em;
  color: var(--t2);
}
.input-wrap { position: relative; }
.input-icon {
  position: absolute; left: 12px; top: 50%; transform: translateY(-50%);
  color: var(--t3); pointer-events: none; z-index: 1;
}
.input-wrap input {
  padding-left: 36px;
}

.login-btn {
  display: flex; align-items: center; justify-content: center; gap: 10px;
  width: 100%; padding: 14px 20px;
  border-radius: var(--r2);
  background: var(--g-warm);
  border: none;
  color: #fff; font-weight: 700; font-size: 0.97rem;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(167,139,250,0.28), 0 2px 8px rgba(0,0,0,0.3);
  transition: transform 0.16s ease, box-shadow 0.16s ease, filter 0.16s ease;
  position: relative; overflow: hidden;
}
.login-btn::before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(180deg, rgba(255,255,255,0.12) 0%, transparent 100%);
  pointer-events: none;
}
.login-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 32px rgba(167,139,250,0.36), 0 4px 12px rgba(0,0,0,0.3);
  filter: brightness(1.06);
}
.login-btn:active { transform: translateY(0); filter: brightness(0.95); }
.login-btn:disabled { cursor: not-allowed; opacity: 0.5; transform: none; box-shadow: none; }

/* Spinner inside login btn */
.login-btn-spinner {
  width: 16px; height: 16px; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.35);
  border-top-color: #fff;
  animation: spin 0.7s linear infinite;
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

.login-footnote {
  display: flex; align-items: center; gap: 7px;
  font-size: 0.74rem; color: var(--t3); font-weight: 500;
}
.login-footnote svg { flex-shrink: 0; }

.username-hint {
  color: var(--amber); font-size: 0.82rem; font-weight: 600;
}
:root.light .username-hint { color: #b45309; }

.username-suggestions { display: flex; flex-wrap: wrap; gap: 8px; }
.suggestion-chip {
  padding: 5px 12px; border-radius: var(--rp);
  border: 1px solid rgba(167,139,250,0.22);
  background: rgba(167,139,250,0.07);
  color: var(--violet); font-size: 0.78rem; font-weight: 600;
  cursor: pointer; transition: background 0.18s, border-color 0.18s;
  font-family: inherit;
}
.suggestion-chip:hover {
  background: rgba(167,139,250,0.14);
  border-color: rgba(167,139,250,0.4);
}
:root.light .suggestion-chip {
  color: var(--violet-d);
  border-color: rgba(124,58,237,0.22);
  background: rgba(124,58,237,0.06);
}

/* ═══ Form controls ══════════════════════════════ */
input, button { font: inherit; }

input {
  width: 100%; padding: 12px 15px;
  border-radius: var(--r1); border: 1px solid var(--input-border);
  background: var(--input-bg); color: var(--t1);
  transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
  -webkit-appearance: none;
}
input::placeholder { color: var(--t3); }
input:focus {
  outline: none;
  border-color: rgba(167,139,250,0.45);
  background: rgba(167,139,250,0.04);
  box-shadow: 0 0 0 3px rgba(167,139,250,0.10);
}
:root.light input:focus {
  border-color: rgba(124,58,237,0.42);
  background: rgba(124,58,237,0.04);
  box-shadow: 0 0 0 3px rgba(124,58,237,0.09);
}

button {
  display: inline-flex; align-items: center; justify-content: center; gap: 7px;
  padding: 12px 20px; border: none; border-radius: var(--r1);
  background: var(--g-brand); color: #fff;
  font-weight: 700; font-size: 0.92rem; letter-spacing: 0.01em;
  cursor: pointer;
  transition: transform 0.15s ease, filter 0.15s ease, box-shadow 0.15s;
  box-shadow: 0 4px 18px rgba(167,139,250,0.20);
  white-space: nowrap;
}
button:hover {
  transform: translateY(-2px);
  filter: brightness(1.10);
  box-shadow: 0 8px 28px rgba(167,139,250,0.30);
}
button:active { transform: translateY(0); filter: brightness(0.96); }
button:disabled { cursor: not-allowed; opacity: 0.4; filter: grayscale(0.3); transform: none; box-shadow: none; }

/* ═══ Chat layout ════════════════════════════════ */
.chat-layout {
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr;
  grid-template-rows: 1fr;
  gap: 14px; flex: 1; height: 0; min-height: 0;
  animation: fadeUp 0.48s cubic-bezier(0.22, 1, 0.36, 1);
  overflow: hidden;
}

/* ═══ Sidebar ════════════════════════════════════ */
.sidebar {
  display: grid; grid-template-rows: auto auto auto 1fr;
  gap: 10px; padding: 14px; height: 100%; min-height: 0; overflow: hidden;
}

.me-row {
  display: flex; justify-content: space-between; align-items: center;
  gap: 10px; padding: 11px 14px; border-radius: var(--r2);
  border: 1px solid var(--b3);
  background:
    radial-gradient(ellipse 80% 80% at 0% 50%, rgba(167,139,250,0.06), transparent),
    rgba(255,255,255,0.025);
  flex-shrink: 0;
}
:root.light .me-row {
  border-color: rgba(124,58,237,0.14);
  background:
    radial-gradient(ellipse 80% 80% at 0% 50%, rgba(124,58,237,0.05), transparent),
    rgba(255,255,255,0.65);
}

.me-avatar {
  width: 36px; height: 36px; border-radius: 50%;
  background: var(--g-brand);
  display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 0.85rem; color: #fff;
  letter-spacing: 0; flex-shrink: 0;
  box-shadow: 0 0 0 2px rgba(167,139,250,0.25), var(--glow-brand);
}
.me-avatar-wrap {
  position: relative; width: 36px; height: 36px; flex-shrink: 0;
}
.me-avatar-wrap .me-avatar { width: 100%; height: 100%; }

.me-row-info { display: flex; align-items: center; gap: 10px; min-width: 0; }
.me-row-text {
  min-width: 0; display: flex; flex-direction: column; align-items: flex-start; gap: 3px;
}
.me-row-text h2 {
  font-size: 1rem; font-weight: 700; margin-top: 1px;
  background: var(--g-brand);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.add-friend-form {
  display: grid; grid-template-columns: 1fr auto;
  gap: 8px; flex-shrink: 0;
}
.add-friend-form input { font-size: 0.88rem; }
.add-friend-form button {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--b3);
  box-shadow: none; color: var(--violet);
  font-size: 0.85rem; padding: 0 14px;
  gap: 5px;
}
.add-friend-form button:hover {
  background: rgba(167,139,250,0.10);
  border-color: rgba(167,139,250,0.35);
  box-shadow: none; transform: none;
}
:root.light .add-friend-form button {
  background: rgba(0,0,0,0.04);
  border-color: rgba(0,0,0,0.10);
  color: var(--violet-d);
}

.list-panel { display: grid; grid-template-rows: auto 1fr; gap: 8px; min-height: 0; overflow: hidden; }
.list-panel:not(.friends-panel) { max-height: 190px; }
.friends-panel { min-height: 0; overflow: hidden; }

.list-head { display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
.list-head h3 {
  font-size: 0.7rem; font-weight: 800;
  text-transform: uppercase; letter-spacing: 0.13em; color: var(--t3);
}

.count-pill {
  padding: 2px 9px; border-radius: var(--rp);
  font-size: 0.68rem; font-weight: 800; color: var(--violet);
  background: rgba(167,139,250,0.10);
  border: 1px solid rgba(167,139,250,0.20);
}
:root.light .count-pill {
  color: var(--violet-d);
  background: rgba(124,58,237,0.08);
  border-color: rgba(124,58,237,0.18);
}

#requestList, #friendList {
  overflow-y: auto; display: flex; flex-direction: column;
  gap: 5px; min-height: 0; padding-right: 2px;
  scrollbar-width: thin;
  scrollbar-color: rgba(167,139,250,0.18) transparent;
}

.item-card {
  border-radius: var(--r1); border: 1px solid var(--b1);
  background: rgba(255,255,255,0.03);
  padding: 10px 12px; color: var(--t2); font-weight: 500;
  transition: border-color 0.18s, background 0.18s; flex-shrink: 0;
}
.item-card:hover {
  border-color: rgba(167,139,250,0.16);
  background: rgba(167,139,250,0.04);
}
:root.light .item-card { background: rgba(255,255,255,0.72); }
:root.light .item-card:hover {
  background: rgba(124,58,237,0.05);
  border-color: rgba(124,58,237,0.14);
}

.request-row { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.request-row span { font-size: 0.88rem; color: var(--t1); font-weight: 600; }
.request-row button { padding: 5px 12px; border-radius: 7px; font-size: 0.76rem; box-shadow: none; }

/* ── Friend items ────────────────────────────────── */
.friend-btn {
  width: 100%; display: flex; justify-content: space-between; align-items: center;
  gap: 10px; padding: 9px 10px;
  border: 1px solid transparent; border-radius: var(--r1);
  background: rgba(255,255,255,0.022); color: var(--t1);
  text-align: left; font-weight: 500; font-size: 0.9rem;
  cursor: pointer;
  transition: background 0.18s, border-color 0.18s;
  box-shadow: none; flex-shrink: 0;
}
.friend-btn:hover {
  background: rgba(167,139,250,0.06);
  border-color: rgba(167,139,250,0.16);
  transform: none; filter: none; box-shadow: none;
}
.friend-btn.active {
  background: rgba(167,139,250,0.10);
  border-color: rgba(167,139,250,0.28);
}
:root.light .friend-btn { background: rgba(255,255,255,0.52); }
:root.light .friend-btn:hover {
  background: rgba(124,58,237,0.06);
  border-color: rgba(124,58,237,0.14);
}
:root.light .friend-btn.active {
  background: rgba(124,58,237,0.10);
  border-color: rgba(124,58,237,0.26);
}

.friend-avatar {
  width: 34px; height: 34px; border-radius: 50%;
  background: var(--g-brand);
  display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 0.78rem; color: #fff; flex-shrink: 0;
  position: relative;
}
.friend-avatar::after {
  content: ''; position: absolute; bottom: 1px; right: 1px;
  width: 9px; height: 9px; border-radius: 50%;
  background: var(--t3);
  border: 2px solid var(--bg-void);
  transition: background 0.3s;
}
.friend-avatar.online::after {
  background: var(--emerald);
  box-shadow: 0 0 6px var(--emerald);
}

.friend-main { display: flex; flex-direction: column; gap: 2px; min-width: 0; flex: 1; }
.friend-name {
  font-weight: 700; font-size: 0.91rem; color: var(--t1);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.friend-preview {
  font-size: 0.74rem; color: var(--t3);
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}

.friend-side { display: flex; flex-direction: column; align-items: flex-end; gap: 5px; flex-shrink: 0; }
.status {
  font-size: 0.70rem; color: var(--t3); font-weight: 500;
  max-width: 132px; white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis; text-align: right;
}
.status.online { color: var(--emerald); }

.unread-badge {
  padding: 2px 7px; border-radius: var(--rp); min-width: 1.3rem;
  text-align: center; font-size: 0.66rem; font-weight: 800;
  color: #fff;
  background: var(--g-brand);
  box-shadow: 0 0 10px rgba(167,139,250,0.45);
}

/* ═══ Chat panel ═════════════════════════════════ */
.chat {
  display: grid;
  grid-template-rows: auto auto 1fr auto auto;
  gap: 10px; padding: 14px;
  height: 100%; min-height: 0; overflow: hidden;
}

.chat-header {
  display: flex; align-items: center;
  gap: 12px; padding: 11px 16px; border-radius: var(--r2);
  border: 1px solid rgba(167,139,250,0.10);
  background:
    radial-gradient(ellipse 80% 80% at 100% 50%, rgba(236,72,153,0.06), transparent),
    rgba(255,255,255,0.025);
  flex-shrink: 0;
}
:root.light .chat-header {
  border-color: rgba(124,58,237,0.10);
  background:
    radial-gradient(ellipse 80% 80% at 100% 50%, rgba(124,58,237,0.04), transparent),
    rgba(255,255,255,0.82);
}

.active-presence { width: 34px; height: 34px; flex-shrink: 0; }
.active-avatar {
  width: 100%; height: 100%; border-radius: 50%;
  background: var(--g-brand);
  display: flex; align-items: center; justify-content: center;
  color: #fff; font-size: 0.75rem; font-weight: 800;
  position: relative;
  box-shadow: 0 0 0 1px rgba(167,139,250,0.22), 0 6px 16px rgba(0,0,0,0.28);
}
.active-avatar::after {
  content: ""; position: absolute; right: 0; bottom: 1px;
  width: 9px; height: 9px; border-radius: 50%;
  border: 2px solid var(--bg-void);
  background: var(--t3);
}
.active-avatar.online::after {
  background: var(--emerald);
  box-shadow: 0 0 7px rgba(52,211,153,0.9);
}

.chat-header-info { flex: 1; min-width: 0; }
.chat-header h2 {
  font-size: clamp(1.05rem, 1.6vw, 1.32rem);
  font-weight: 700; margin-top: 1px;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.active-friend-presence {
  margin-top: 2px; font-size: 0.72rem; font-weight: 600;
  color: var(--t3); white-space: nowrap;
  overflow: hidden; text-overflow: ellipsis;
}
.active-friend-presence.online { color: var(--emerald); }

/* Chat header actions cluster */
.chat-header-actions {
  display: flex; align-items: center; gap: 8px; flex-shrink: 0;
}

/* Generic icon button */
.icon-btn {
  width: 34px; height: 34px; min-width: 34px;
  display: inline-flex; align-items: center; justify-content: center;
  border-radius: 50%;
  border: 1px solid var(--b2);
  background: var(--bg-surface);
  color: var(--t2);
  cursor: pointer;
  box-shadow: none;
  transition: background 0.16s, border-color 0.16s, color 0.16s, transform 0.12s;
  flex-shrink: 0;
  padding: 0;
}
.icon-btn:hover {
  background: rgba(167,139,250,0.10);
  border-color: rgba(167,139,250,0.30);
  color: var(--violet);
  transform: translateY(-1px);
  filter: none;
  box-shadow: none;
}
.icon-btn.active {
  background: rgba(167,139,250,0.16);
  border-color: rgba(167,139,250,0.42);
  color: var(--violet);
}
:root.light .icon-btn { background: rgba(255,255,255,0.6); border-color: rgba(0,0,0,0.09); }
:root.light .icon-btn:hover { background: rgba(124,58,237,0.08); border-color: rgba(124,58,237,0.22); color: var(--violet-d); }

/* Online count pill — now in its own little badge */
.online-count-pill {
  display: inline-flex; align-items: center;
  padding: 3px 10px; border-radius: var(--rp);
  border: 1px solid rgba(52,211,153,0.20);
  background: rgba(52,211,153,0.07);
  font-size: 0.7rem; font-weight: 700; color: var(--emerald);
  white-space: nowrap;
}
:root.light .online-count-pill {
  border-color: rgba(16,185,129,0.22);
  background: rgba(16,185,129,0.06);
  color: #059669;
}

.remove-friend-btn {
  display: inline-flex; align-items: center; gap: 6px;
  height: 34px; padding: 0 12px;
  border-radius: var(--rp);
  border: 1px solid rgba(248,113,113,0.40);
  background: rgba(248,113,113,0.08);
  color: #fca5a5;
  font-size: 0.74rem; font-weight: 700;
  letter-spacing: 0.03em; text-transform: uppercase;
  cursor: pointer; box-shadow: none;
  transition: background 0.18s, border-color 0.18s, transform 0.12s;
  flex-shrink: 0;
}
.remove-friend-btn:hover {
  background: rgba(248,113,113,0.16);
  border-color: rgba(248,113,113,0.65);
  transform: translateY(-1px);
  box-shadow: 0 4px 14px rgba(248,113,113,0.18);
  filter: none;
}
.remove-friend-btn svg { width: 15px; height: 15px; opacity: 0.95; }
:root.light .remove-friend-btn {
  border-color: rgba(220,38,38,0.35);
  background: rgba(220,38,38,0.07);
  color: #dc2626;
}

/* ── Search popover ──────────────────────────────── */
.chat-search-popover {
  margin-top: -2px; display: flex; flex-direction: column;
  gap: 6px; padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid rgba(167,139,250,0.16);
  background: rgba(255,255,255,0.03);
}
.chat-search-popover-row {
  display: grid; grid-template-columns: 1fr auto;
  gap: 8px; align-items: center;
}
.chat-search-popover input {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 10px; padding: 8px 10px;
  box-shadow: none; font-size: 0.82rem;
}
.chat-search-popover input:focus {
  border-color: rgba(167,139,250,0.50);
  box-shadow: 0 0 0 2px rgba(167,139,250,0.12);
}
.chat-search-popover button {
  height: 32px; padding: 0 10px; border-radius: 9px;
  border: 1px solid var(--b2);
  background: rgba(255,255,255,0.05);
  color: var(--t2); box-shadow: none;
  font-size: 0.73rem; font-weight: 700;
}
.chat-search-popover button:hover {
  transform: none; filter: none;
  background: rgba(167,139,250,0.10);
  border-color: rgba(167,139,250,0.30);
  color: var(--violet); box-shadow: none;
}
.chat-search-count {
  align-self: flex-end; font-size: 0.72rem;
  font-weight: 700; color: var(--violet);
}

/* ═══ Messages area ══════════════════════════════ */
.messages-wrap {
  flex: 1; min-height: 0; position: relative; overflow: hidden;
  display: flex; flex-direction: column;
}

.messages {
  flex: 1; overflow-y: auto; min-height: 0;
  display: flex; flex-direction: column;
  gap: 8px; padding: 6px 14px 10px;
  scrollbar-width: thin;
  scrollbar-color: rgba(167,139,250,0.18) transparent;
}

/* ── Empty state ─────────────────────────────────── */
.messages-empty {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  flex: 1; gap: 10px; text-align: center;
  padding: 32px 20px;
}
.messages-empty-icon {
  width: 72px; height: 72px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  background: rgba(167,139,250,0.08);
  border: 1px solid rgba(167,139,250,0.14);
  color: var(--violet);
  margin-bottom: 4px;
}
:root.light .messages-empty-icon {
  background: rgba(124,58,237,0.06);
  border-color: rgba(124,58,237,0.14);
  color: var(--violet-d);
}
.messages-empty-title {
  font-size: 1rem; font-weight: 700; color: var(--t2);
}
.messages-empty-sub {
  font-size: 0.84rem; color: var(--t3); max-width: 28ch; line-height: 1.55;
}

/* ── Scroll FAB ──────────────────────────────────── */
.scroll-btn {
  position: absolute; bottom: 14px; right: 14px; z-index: 10;
  width: 38px; height: 38px; border-radius: 50%; padding: 0;
  background: var(--panel-bg);
  border: 1px solid var(--b3);
  color: var(--violet); box-shadow: var(--s2);
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.22s, transform 0.22s;
  transform: translateY(8px);
}
.scroll-btn.visible { opacity: 1; pointer-events: auto; transform: translateY(0); }
.scroll-btn:hover { background: rgba(167,139,250,0.12); transform: translateY(-1px); filter: none; box-shadow: var(--s2); }
.scroll-btn-badge {
  position: absolute; top: -4px; right: -4px;
  min-width: 17px; height: 17px; padding: 0 4px;
  border-radius: var(--rp);
  background: var(--g-brand); color: #fff;
  font-size: 0.62rem; font-weight: 800;
  display: flex; align-items: center; justify-content: center;
}

/* ── Message bubbles ─────────────────────────────── */
.message {
  display: flex; flex-direction: column;
  max-width: 72%; position: relative;
  padding: 9px 13px; border-radius: 18px;
  animation: bubblePop 0.22s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}
.message.no-anim { animation: none !important; }

.message.them {
  align-self: flex-start;
  background: var(--msg-them-bg);
  border: 1px solid var(--msg-them-bdr);
  border-bottom-left-radius: 4px;
}
.message.me {
  align-self: flex-end;
  background: var(--g-me-msg);
  border: 1px solid rgba(167,139,250,0.18);
  border-bottom-right-radius: 4px;
}
:root.light .message.me { border-color: rgba(124,58,237,0.20); }

.message-meta {
  display: flex; align-items: center; gap: 6px;
  justify-content: flex-start;
  margin-bottom: 5px;
  font-size: 0.68rem; font-weight: 600;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.message-meta.mine { justify-content: flex-end; }
.message.them .message-meta { color: var(--t3); }
.message.me .message-meta { color: rgba(167,139,250,0.55); }
:root.light .message.me .message-meta { color: rgba(109,40,217,0.55); }

.message-meta-time { white-space: nowrap; }
.message-status {
  display: inline-flex; align-items: center; gap: 0;
  font-size: 0.7rem; line-height: 1;
  color: rgba(200,190,240,0.5);
}
.message-status .tick:last-child { margin-left: -2px; }
.message-status-sent .tick:last-child { opacity: 0; }
.message-status-delivered { color: rgba(200,190,240,0.65); }
.message-status-seen { color: var(--violet); }

.message-body {
  font-size: 0.9rem; line-height: 1.55; word-break: break-word;
  color: var(--t1);
}
.message-body-deleted {
  font-style: italic; color: var(--t3);
}
.message-deleted { opacity: 0.8; }

/* Date separators */
.message-date-separator {
  align-self: center; margin: 6px 0; padding: 3px 12px;
  border-radius: var(--rp);
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.035);
  color: var(--t3); font-size: 0.66rem; font-weight: 700;
  letter-spacing: 0.05em; text-transform: uppercase;
}
.message.search-hidden,
.message-date-separator.search-hidden { display: none !important; }

/* Full timestamp tooltip */
.message[data-ts-full]:hover::after {
  content: attr(data-ts-full);
  position: absolute; left: 12px; bottom: calc(100% + 6px);
  z-index: 15; padding: 4px 8px; border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(8,5,22,0.96);
  color: var(--t2); font-size: 0.64rem; font-weight: 700;
  white-space: nowrap; pointer-events: none;
}
.message.me[data-ts-full]:hover::after { left: auto; right: 12px; }

/* ── Reactions ───────────────────────────────────── */
.message-reactions {
  display: flex; flex-wrap: nowrap; gap: 4px;
  margin-top: 6px; max-width: 100%;
  overflow-x: auto; overflow-y: hidden;
  -webkit-overflow-scrolling: touch; padding-bottom: 2px;
}
.reaction-btn {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 2px 8px; border-radius: var(--rp);
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.10);
  font-size: 0.78rem; font-weight: 600; color: var(--t2);
  cursor: pointer; box-shadow: none;
  transition: background 0.15s, border-color 0.15s;
  flex: 0 0 auto; white-space: nowrap;
}
.reaction-btn:hover { background: rgba(255,255,255,0.12); border-color: rgba(255,255,255,0.22); transform: none; filter: none; }
.reaction-btn.mine {
  background: rgba(167,139,250,0.12);
  border-color: rgba(167,139,250,0.32);
  color: var(--violet);
}
:root.light .reaction-btn { background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.08); }
:root.light .reaction-btn.mine {
  background: rgba(124,58,237,0.10);
  border-color: rgba(124,58,237,0.28);
  color: var(--violet-d);
}
.message-reactions::-webkit-scrollbar { height: 0; }

/* Reaction picker */
.reaction-picker {
  background: var(--panel-bg);
  border: 1px solid var(--b2); border-radius: var(--r2);
  padding: 6px 8px; display: flex; gap: 4px;
  max-width: calc(100vw - 16px); flex-wrap: wrap;
  box-shadow: var(--s2); backdrop-filter: blur(16px);
  animation: fadeUp 0.15s ease;
}
.reaction-picker button {
  background: none; border: none; padding: 4px 5px;
  font-size: 1.1rem; border-radius: 6px; box-shadow: none;
  cursor: pointer; transition: background 0.12s, transform 0.12s;
}
.reaction-picker button:hover {
  background: rgba(167,139,250,0.12);
  transform: scale(1.25); filter: none; box-shadow: none;
}
:root.light .reaction-picker button:hover { background: rgba(0,0,0,0.06); }
.reaction-picker-more {
  font-size: 1rem !important; font-weight: 800 !important; color: var(--violet);
}

/* ── Message hover actions ──────────────────────── */
.message:hover .msg-actions { opacity: 1; pointer-events: auto; }
.msg-actions {
  position: absolute; top: -14px;
  display: flex; gap: 3px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.15s;
}
.message.me   .msg-actions { right: 4px; }
.message.them .msg-actions { left: 4px; }
.msg-action-btn {
  width: 26px; height: 26px; border-radius: 50%; padding: 0;
  background: var(--panel-bg); border: 1px solid var(--b1);
  color: var(--t2); cursor: pointer; box-shadow: var(--s1);
  display: flex; align-items: center; justify-content: center;
  font-size: 0.78rem;
  transition: background 0.12s, transform 0.12s;
}
.msg-action-btn:hover {
  background: rgba(167,139,250,0.12);
  transform: scale(1.12); filter: none; box-shadow: var(--s1);
}

/* Reply quote inside bubble */
.reply-quote {
  display: flex; flex-direction: column; gap: 1px;
  background: rgba(0,0,0,0.18);
  border-left: 3px solid rgba(167,139,250,0.55);
  border-radius: 4px; padding: 4px 8px;
  margin-bottom: 5px; cursor: pointer;
  transition: background 0.15s; max-width: 100%;
}
.reply-quote:hover { background: rgba(0,0,0,0.26); }
.reply-quote-author { font-size: 0.7rem; font-weight: 600; color: rgba(167,139,250,0.85); }
.reply-quote-text { font-size: 0.75rem; color: rgba(255,255,255,0.5); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.message.them .reply-quote { border-left-color: rgba(0,0,0,0.20); background: rgba(0,0,0,0.06); }
.message.them .reply-quote-author { color: rgba(0,0,0,0.55); }
.message.them .reply-quote-text { color: rgba(0,0,0,0.40); }

/* Highlight flash */
@keyframes highlightFlash {
  0%   { outline: 2px solid var(--violet); outline-offset: 2px; }
  60%  { outline: 2px solid var(--violet); outline-offset: 2px; }
  100% { outline: 2px solid transparent; outline-offset: 2px; }
}
.message.highlight-flash { animation: highlightFlash 1.2s ease forwards; }

/* ═══ Typing indicator ═══════════════════════════ */
.typing-indicator {
  display: flex; align-items: center; gap: 10px;
  padding: 4px 18px 8px; min-height: 40px;
}
.snap-typing-bubble {
  display: flex; align-items: center; gap: 5px;
  background: var(--msg-them-bg);
  border: 1px solid var(--msg-them-bdr);
  border-radius: 20px; padding: 8px 14px;
  box-shadow: var(--s1);
  animation: snapBubbleIn 0.25s cubic-bezier(0.34,1.56,0.64,1) both;
}
@keyframes snapBubbleIn {
  from { transform: scale(0.6) translateY(6px); opacity: 0; }
  to   { transform: scale(1)   translateY(0);   opacity: 1; }
}
.snap-dot {
  display: block; width: 9px; height: 9px; border-radius: 50%;
  background: var(--violet); opacity: 0.35;
  animation: snapPulse 1.1s cubic-bezier(0.45,0.05,0.55,0.95) infinite;
}
.snap-dot:nth-child(1) { animation-delay: 0s; }
.snap-dot:nth-child(2) { animation-delay: 0.18s; }
.snap-dot:nth-child(3) { animation-delay: 0.36s; }
@keyframes snapPulse {
  0%,100% { transform: scale(0.65); opacity: 0.28; }
  40%     { transform: scale(1.25); opacity: 1; background: var(--violet); }
  60%     { transform: scale(1.1);  opacity: 0.85; }
}
.snap-typing-label { font-size: 0.72rem; color: var(--t2); letter-spacing: 0.01em; }

/* ═══ Message form ════════════════════════════════ */
.message-form-wrap { display: flex; flex-direction: column; gap: 4px; flex-shrink: 0; }

.message-form {
  display: grid; grid-template-columns: 1fr auto;
  gap: 8px; padding: 7px; border-radius: var(--r2);
  border: 1px solid rgba(255,255,255,0.07);
  background: rgba(255,255,255,0.03);
  transition: border-color 0.2s, box-shadow 0.2s;
  flex-shrink: 0;
}
.message-form:focus-within {
  border-color: rgba(167,139,250,0.26);
  box-shadow: 0 0 0 2px rgba(167,139,250,0.07);
}
:root.light .message-form {
  border-color: rgba(0,0,0,0.07);
  background: rgba(255,255,255,0.72);
}
:root.light .message-form:focus-within {
  border-color: rgba(124,58,237,0.28);
  box-shadow: 0 0 0 2px rgba(124,58,237,0.07);
}

.message-form input {
  border: none; background: transparent;
  padding: 10px 12px; font-size: 0.93rem; box-shadow: none !important;
}
.message-form input:disabled { color: var(--t3); }
.message-form button {
  background: var(--g-send);
  box-shadow: 0 0 18px rgba(167,139,250,0.16);
  padding: 0 22px; font-size: 0.88rem;
}
.message-form button:hover {
  box-shadow: 0 6px 22px rgba(167,139,250,0.30);
}

.char-counter {
  font-size: 0.68rem; font-weight: 600; color: var(--t3);
  text-align: right; padding: 0 4px;
  transition: color 0.2s;
}
.char-counter.warn  { color: var(--amber); }
.char-counter.limit { color: var(--danger); }

/* ── Reply banner ────────────────────────────────── */
.reply-banner {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 12px;
  background: rgba(167,139,250,0.08);
  border-left: 3px solid var(--violet);
  font-size: 0.78rem; color: var(--t2);
  border-radius: 6px 6px 0 0; margin: 0 12px;
}
.reply-banner.hidden { display: none; }
.reply-preview-text { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.reply-cancel-btn {
  background: none; border: none; color: var(--t2);
  cursor: pointer; font-size: 0.9rem; padding: 0 4px;
  border-radius: 4px; transition: color 0.15s; line-height: 1;
  box-shadow: none;
}
.reply-cancel-btn:hover { color: var(--t1); transform: none; filter: none; box-shadow: none; }

/* ═══ Toast ══════════════════════════════════════ */
.toast {
  position: fixed; right: 20px; bottom: 20px; z-index: 200;
  pointer-events: none;
  max-width: 320px; padding: 12px 16px;
  border-radius: var(--r2);
  border: 1px solid rgba(167,139,250,0.18);
  border-left: 3px solid var(--violet);
  background: rgba(8,5,22,0.96); backdrop-filter: blur(22px);
  color: var(--t1); font-weight: 600; font-size: 0.87rem;
  box-shadow: var(--s2), var(--glow-brand);
  animation: toastSlide 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
.toast.error {
  border-left-color: var(--danger);
  border-color: rgba(248,113,113,0.18);
  box-shadow: var(--s2), 0 0 18px rgba(248,113,113,0.14);
}
.toast.success {
  border-left-color: var(--emerald);
  border-color: rgba(52,211,153,0.18);
  box-shadow: var(--s2), 0 0 16px rgba(52,211,153,0.14);
}
:root.light .toast {
  background: rgba(250,248,255,0.97);
  color: var(--t1);
  border-color: rgba(124,58,237,0.16);
  border-left-color: var(--violet-d);
  box-shadow: var(--s2);
}
:root.light .toast.error { border-left-color: var(--danger); border-color: rgba(248,113,113,0.18); }
:root.light .toast.success { border-left-color: #059669; border-color: rgba(16,185,129,0.18); }

/* ═══ Scrollbars ══════════════════════════════════ */
#requestList::-webkit-scrollbar,
#friendList::-webkit-scrollbar,
.messages::-webkit-scrollbar { width: 4px; }
#requestList::-webkit-scrollbar-thumb,
#friendList::-webkit-scrollbar-thumb,
.messages::-webkit-scrollbar-thumb {
  background: rgba(167,139,250,0.18); border-radius: var(--rp);
}
#requestList::-webkit-scrollbar-track,
#friendList::-webkit-scrollbar-track,
.messages::-webkit-scrollbar-track { background: transparent; }

/* ═══ Sidebar controls ════════════════════════════ */
.me-row-btns { display: flex; align-items: center; gap: 6px; }

.profile-avatar-btn {
  position: absolute; right: -5px; bottom: -4px;
  width: 20px; height: 20px; border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.55);
  background: var(--g-brand);
  color: #fff;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  transition: transform 0.15s, filter 0.15s;
  padding: 0; line-height: 1;
}
.profile-avatar-btn:hover { transform: scale(1.12); filter: brightness(1.08); }
:root.light .profile-avatar-btn { border-color: rgba(255,255,255,0.75); }

.logout-btn {
  display: flex; align-items: center; justify-content: center;
  width: 34px; height: 34px; border-radius: 50%;
  border: 1px solid var(--b1);
  background: rgba(248,113,113,0.06);
  color: rgba(248,113,113,0.65);
  cursor: pointer; padding: 0; box-shadow: none; flex-shrink: 0;
  transition: background 0.18s, color 0.18s, border-color 0.18s, transform 0.15s;
}
.logout-btn:hover {
  background: rgba(248,113,113,0.14);
  border-color: rgba(248,113,113,0.32);
  color: var(--danger);
  transform: none; filter: none;
  box-shadow: 0 0 12px rgba(248,113,113,0.18);
}
:root.light .logout-btn { background: rgba(220,38,38,0.05); }

/* ── Mobile back button ──────────────────────────── */
.mob-back-btn { display: none; }

/* ═══ Context menu ════════════════════════════════ */
.message-context-menu {
  position: fixed; z-index: 10020;
  min-width: 160px; display: flex; flex-direction: column;
  gap: 4px; padding: 6px;
  border-radius: 12px;
  border: 1px solid rgba(167,139,250,0.22);
  background: rgba(7,5,22,0.96);
  box-shadow: 0 16px 34px rgba(0,0,0,0.50);
  backdrop-filter: blur(16px);
}
.message-context-menu button {
  height: 32px; justify-content: flex-start;
  padding: 0 10px; border-radius: 8px;
  border: 1px solid transparent;
  background: transparent; color: var(--t1);
  font-size: 0.78rem; font-weight: 700; box-shadow: none;
}
.message-context-menu button:hover {
  transform: none; filter: none;
  background: rgba(167,139,250,0.10);
  border-color: rgba(167,139,250,0.20);
}
.message-context-menu button.danger { color: #fca5a5; }
.message-context-menu button.danger:hover {
  background: rgba(248,113,113,0.12);
  border-color: rgba(248,113,113,0.28);
}

/* ═══ Profile Modal ════════════════════════════════ */
.profile-modal {
  position: fixed; inset: 0; z-index: 1000;
  padding: 18px; align-items: center; justify-content: center;
  display: none;
}
.profile-modal-backdrop {
  position: absolute; inset: 0;
  background:
    radial-gradient(circle at 18% 22%, rgba(124,58,237,0.12), transparent 42%),
    radial-gradient(circle at 85% 78%, rgba(236,72,153,0.14), transparent 46%),
    rgba(3,2,12,0.80);
  backdrop-filter: blur(10px);
}
.profile-modal-card {
  position: relative; z-index: 1;
  width: min(560px, 96vw);
  max-height: min(900px, 92vh);
  overflow-y: auto; overflow-x: hidden;
  background: linear-gradient(165deg, rgba(8,5,30,0.97), rgba(6,4,22,0.93));
  border: 1px solid rgba(167,139,250,0.18);
  border-radius: 24px;
  box-shadow: 0 26px 70px rgba(0,0,0,0.70), inset 0 0 0 1px rgba(255,255,255,0.03);
  padding: 24px 22px 22px;
  display: flex; flex-direction: column; gap: 16px;
  animation: modalSlideUp 0.28s cubic-bezier(0.34,1.56,0.64,1) both;
}
@media (max-width: 640px) {
  .profile-modal-card { width: 100%; padding: 18px 14px 16px; border-radius: 20px; }
}
@keyframes modalSlideUp {
  from { transform: translateY(32px) scale(0.96); opacity: 0; }
  to   { transform: translateY(0) scale(1); opacity: 1; }
}
.profile-modal-header {
  display: flex; align-items: flex-start; justify-content: space-between; gap: 12px;
}
.profile-modal-heading { min-width: 0; flex: 1; }
.profile-modal-eyebrow {
  margin: 0 0 2px;
  font-size: 0.66rem; font-weight: 700;
  letter-spacing: 0.14em; text-transform: uppercase;
  color: rgba(167,139,250,0.72);
}
.profile-modal-header h3 {
  font-size: 1.22rem; font-weight: 800; color: var(--t1);
  letter-spacing: -0.02em; margin: 0;
}
.profile-modal-subtitle {
  margin: 4px 0 0; font-size: 0.82rem; line-height: 1.45; color: var(--t2);
}
.profile-modal-close {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--b2);
  border-radius: 10px;
  width: 38px; height: 38px; min-width: 38px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--t2);
  transition: background 0.16s, color 0.16s, transform 0.12s;
  padding: 0; box-shadow: none;
}
.profile-modal-close:hover {
  background: rgba(248,113,113,0.12);
  border-color: rgba(248,113,113,0.28);
  color: #fca5a5;
  transform: scale(1.05); filter: none;
  box-shadow: none;
}
.profile-modal-close-icon { display: block; }

.profile-identity {
  display: grid; grid-template-columns: auto 1fr;
  gap: 14px; align-items: center;
  padding: 10px 12px; border-radius: 16px;
  border: 1px solid rgba(167,139,250,0.14);
  background: linear-gradient(135deg, rgba(167,139,250,0.06), rgba(236,72,153,0.07));
}
@media (max-width: 560px) {
  .profile-identity { grid-template-columns: 1fr; justify-items: center; text-align: center; padding: 10px; }
}
.profile-avatar-preview {
  display: flex; flex-direction: column; align-items: center; gap: 6px;
}
.profile-avatar-big {
  width: 84px; height: 84px; border-radius: 50%;
  background: var(--g-brand);
  display: flex; align-items: center; justify-content: center;
  font-size: 2.15rem;
  border: 3px solid rgba(255,255,255,0.22);
  box-shadow: var(--s2), 0 0 0 6px rgba(167,139,250,0.10);
  transition: transform 0.2s, background 0.3s;
  user-select: none;
}
.profile-avatar-hint { margin: 0; font-size: 0.72rem; color: var(--t3); }
.profile-identity-copy { min-width: 0; }
.profile-identity-title { margin: 0; font-size: 0.9rem; font-weight: 700; color: var(--t1); }
.profile-identity-desc { margin: 4px 0 0; font-size: 0.78rem; line-height: 1.45; color: var(--t2); }

.profile-avatar-grid-wrap {
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 16px; padding: 9px;
  background: rgba(255,255,255,0.022);
}
.profile-avatar-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(64px, 1fr));
  gap: 9px; max-height: 290px;
  overflow-y: auto; overflow-x: hidden;
  padding-right: 2px; overscroll-behavior: contain;
}
@media (max-width: 420px) {
  .profile-avatar-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

.av-grid-btn {
  width: 100%; aspect-ratio: 1; border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.14);
  cursor: pointer; font-size: 1.4rem;
  display: flex; align-items: center; justify-content: center;
  transition: transform 0.15s, border-color 0.15s, box-shadow 0.15s;
  box-shadow: var(--s1);
}
.av-grid-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.34); filter: none; }
.av-grid-btn.selected {
  border-color: var(--violet);
  box-shadow: 0 0 0 3px rgba(167,139,250,0.34), 0 10px 20px rgba(0,0,0,0.34);
  transform: translateY(-1px);
}
:root.light .av-grid-btn.selected {
  border-color: var(--violet-d);
  box-shadow: 0 0 0 3px rgba(124,58,237,0.22), 0 8px 16px rgba(0,0,0,0.12);
}

.profile-fields { display: flex; flex-direction: column; gap: 12px; }
.profile-field-row { display: flex; gap: 10px; }
.profile-field-row .profile-field { flex: 1; }
.profile-field { display: flex; flex-direction: column; gap: 6px; flex: 1; }
.profile-field label {
  font-size: 0.70rem; font-weight: 700;
  color: var(--t2); letter-spacing: 0.09em; text-transform: uppercase;
}
.profile-field input, .profile-field select {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.11);
  border-radius: 12px; padding: 10px 12px;
  color: var(--t1); font-size: 0.92rem;
  font-family: inherit; outline: none; width: 100%; box-sizing: border-box;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.profile-field input:focus, .profile-field select:focus {
  border-color: rgba(167,139,250,0.65);
  box-shadow: 0 0 0 2px rgba(167,139,250,0.18);
}
.profile-field input::placeholder { color: rgba(200,190,240,0.38); }
.profile-field-help { margin: 0; font-size: 0.72rem; color: var(--t3); }
.profile-field select option { background: #1a1530; color: #f0eeff; }
:root.light .profile-field input, :root.light .profile-field select {
  background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.09);
}
:root.light .profile-field input::placeholder { color: rgba(30,15,70,0.40); }
:root.light .profile-field input:focus, :root.light .profile-field select:focus {
  border-color: var(--violet-d); box-shadow: 0 0 0 2px rgba(124,58,237,0.12);
}
:root.light .profile-field select option { background: #fff; color: #140d2e; }
@media (max-width: 560px) { .profile-field-row { flex-direction: column; gap: 10px; } }

.profile-save-btn {
  width: 100%; padding: 12px 14px; border-radius: 14px;
  border: 1px solid rgba(167,139,250,0.26);
  background: var(--g-warm);
  color: #fff; font-weight: 800; font-size: 0.96rem;
  font-family: inherit; cursor: pointer; letter-spacing: 0.02em;
  transition: opacity 0.2s, transform 0.15s, box-shadow 0.2s;
  box-shadow: 0 10px 24px rgba(167,139,250,0.26);
}
.profile-save-btn:hover {
  opacity: 0.92; transform: translateY(-1px);
  box-shadow: 0 14px 30px rgba(167,139,250,0.30);
}
.profile-modal-card::-webkit-scrollbar,
.profile-avatar-grid::-webkit-scrollbar { width: 5px; }
.profile-modal-card::-webkit-scrollbar-thumb,
.profile-avatar-grid::-webkit-scrollbar-thumb {
  background: var(--b2); border-radius: 4px;
}
:root.light .profile-modal-card {
  background: linear-gradient(165deg, rgba(255,255,255,0.97), rgba(246,243,255,0.94));
  border-color: rgba(124,58,237,0.16);
  box-shadow: 0 24px 54px rgba(14,4,50,0.18);
}
:root.light .profile-modal-eyebrow { color: rgba(109,40,217,0.75); }

/* ═══ Confirm/Unfriend modal ══════════════════════ */
.confirm-modal {
  position: fixed; inset: 0; z-index: 1100;
  padding: 18px; align-items: center; justify-content: center;
  display: none;
}
.confirm-modal-backdrop {
  position: absolute; inset: 0;
  background: rgba(3,2,12,0.75);
  backdrop-filter: blur(8px);
}
.confirm-modal-card {
  position: relative; z-index: 1;
  width: min(380px, 94vw);
  background: linear-gradient(165deg, rgba(10,6,30,0.98), rgba(7,4,20,0.95));
  border: 1px solid rgba(248,113,113,0.22);
  border-radius: 22px;
  box-shadow: 0 24px 60px rgba(0,0,0,0.65);
  padding: 28px 24px 24px;
  display: flex; flex-direction: column; align-items: center;
  gap: 10px; text-align: center;
  animation: modalSlideUp 0.25s cubic-bezier(0.34,1.56,0.64,1) both;
}
.confirm-modal-icon {
  width: 60px; height: 60px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  background: rgba(248,113,113,0.10);
  border: 1px solid rgba(248,113,113,0.22);
  color: #fca5a5; margin-bottom: 2px;
}
.confirm-modal-card h3 {
  font-size: 1.2rem; font-weight: 800; color: var(--t1);
}
.confirm-modal-desc {
  font-size: 0.86rem; color: var(--t2); line-height: 1.55; max-width: 28ch;
}
.confirm-modal-btns {
  display: flex; gap: 10px; width: 100%; margin-top: 6px;
}
.confirm-modal-cancel {
  flex: 1; height: 42px; border-radius: 12px;
  background: rgba(255,255,255,0.06); border: 1px solid var(--b2);
  color: var(--t2); font-weight: 700; font-size: 0.9rem;
  cursor: pointer; box-shadow: none;
}
.confirm-modal-cancel:hover {
  background: rgba(255,255,255,0.10); color: var(--t1);
  transform: none; filter: none; box-shadow: none;
}
.confirm-modal-confirm {
  flex: 1; height: 42px; border-radius: 12px;
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  border: none; color: #fff; font-weight: 700; font-size: 0.9rem;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(220,38,38,0.28);
}
.confirm-modal-confirm:hover {
  box-shadow: 0 10px 24px rgba(220,38,38,0.38);
  transform: translateY(-1px); filter: none;
}
:root.light .confirm-modal-card {
  background: linear-gradient(165deg, rgba(255,255,255,0.97), rgba(255,248,248,0.95));
  border-color: rgba(220,38,38,0.18);
  box-shadow: 0 20px 50px rgba(0,0,0,0.18);
}
:root.light .confirm-modal-card h3 { color: #140d2e; }
:root.light .confirm-modal-icon { color: #dc2626; background: rgba(220,38,38,0.07); }
:root.light .confirm-modal-cancel {
  background: rgba(0,0,0,0.04); border-color: rgba(0,0,0,0.09); color: var(--t2);
}

/* Requests badge pulse */
.count-pill.has-pending {
  color: #fff;
  background: linear-gradient(135deg, #ec4899, #be185d);
  border-color: rgba(236,72,153,0.55);
  box-shadow: 0 0 0 4px rgba(236,72,153,0.12);
  animation: reqPulse 1.8s ease-in-out infinite;
}
@keyframes reqPulse {
  0%,100% { transform: scale(1); }
  50%     { transform: scale(1.08); }
}

/* Online pulse on avatars */
.friend-avatar.online::after,
.active-avatar.online::after {
  animation: onlinePulse 2s ease-in-out infinite;
}
@keyframes onlinePulse {
  0%,100% { box-shadow: 0 0 0 0 rgba(52,211,153,0.45); }
  70%     { box-shadow: 0 0 0 6px rgba(52,211,153,0.04); }
}

/* Me-row overrides */
.me-row .presence-pill { display: none; }

/* ═══ Keyframes ══════════════════════════════════ */
@keyframes driftBlob {
  0%,100% { transform: translate(0,0) scale(1); }
  33%     { transform: translate(3%,2%) scale(1.05); }
  66%     { transform: translate(-2%,-3%) scale(0.96); }
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(18px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes bubblePop {
  from { opacity: 0; transform: scale(0.94) translateY(4px); }
  to   { opacity: 1; transform: scale(1) translateY(0); }
}
@keyframes pulseDot {
  0%,100% { box-shadow: 0 0 0 3px rgba(52,211,153,0.15); }
  50%     { box-shadow: 0 0 0 6px rgba(52,211,153,0.04); }
}
@keyframes toastSlide {
  from { opacity: 0; transform: translateX(18px); }
  to   { opacity: 1; transform: translateX(0); }
}
@keyframes logoRipple {
  0%   { opacity: 0.9; transform: scale(0.6); }
  60%  { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0;   transform: scale(1.2); }
}
@keyframes orbFloat {
  0%,100% { transform: translate(0,0) scale(1); }
  50%     { transform: translate(-10px, 15px) scale(1.05); }
}

/* ═══════════════════════════════════════════════
   RESPONSIVE — Tablet (≤960px)
   ═══════════════════════════════════════════════ */
@media (max-width: 960px) {
  .login-card { grid-template-columns: 1fr; }
  .login-hero { padding: 22px; }
  .hero-headline { font-size: clamp(2rem, 5vw, 2.8rem); }
}

/* ═══════════════════════════════════════════════
   RESPONSIVE — Mobile (≤768px)
   ═══════════════════════════════════════════════ */
@media (max-width: 768px) {
  body { overflow-x: hidden; }
  .app-shell { padding: 0; overflow: hidden; }

  .app-topbar {
    height: auto; padding: 12px 16px 10px; margin-bottom: 0;
    border-bottom: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px); flex-shrink: 0;
  }
  .brand .eyebrow { display: none; }
  .brand h1       { font-size: 1.22rem; }
  .brand-logo     { width: 34px; height: 34px; }
  .network-pill   { padding: 6px 10px; font-size: 0.75rem; }
  #connectionLabel { display: none; }

  .login-card {
    grid-template-columns: 1fr; gap: 0; border-radius: 0;
    border-left: none; border-right: none; border-bottom: none;
    padding: 0; margin-top: 0;
    box-shadow: none; background: transparent; backdrop-filter: none;
  }
  .login-hero { display: none; }
  .login-panel {
    border-radius: 0; border: none; background: transparent;
    padding: 28px 20px 32px; gap: 18px;
  }
  .login-panel-header h3  { font-size: 1.65rem; font-weight: 800; }
  .login-panel-sub { font-size: 0.85rem; }
  .login-btn { padding: 15px; font-size: 1rem; }

  .chat-layout {
    display: block; position: relative; flex: 1; height: 0; overflow: hidden;
  }

  .sidebar, .chat {
    position: absolute; inset: 0; width: 100%; height: 100%;
    border-radius: 0; border: none; box-shadow: none;
    background: var(--mob-bg); backdrop-filter: none;
    transition: transform 0.28s cubic-bezier(0.4,0,0.2,1), opacity 0.28s ease;
    will-change: transform;
  }

  .sidebar {
    display: grid; grid-template-rows: auto auto auto 1fr;
    gap: 0; padding: 16px 16px 20px; overflow-y: auto;
    transform: translateX(0); opacity: 1; z-index: 2;
  }
  .sidebar > * + * { margin-top: 12px; }

  .chat {
    display: grid; grid-template-rows: auto auto 1fr auto auto;
    gap: 0; padding: 0;
    transform: translateX(100%); opacity: 0; z-index: 1;
  }
  .sidebar[data-mob-hidden] { transform: translateX(-100%); opacity: 0; pointer-events: none; }
  .chat:not([data-mob-hidden]) { transform: translateX(0); opacity: 1; z-index: 2; }

  .me-row { border-radius: var(--r2); padding: 12px 14px; }
  .add-friend-form { grid-template-columns: 1fr auto; }
  .list-panel:not(.friends-panel) { max-height: 150px; }
  .friends-panel { min-height: 0; max-height: none; flex: 1; }

  .chat-header {
    border-radius: 0; border: none; border-bottom: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px);
    padding: 12px 14px; gap: 10px;
  }
  .active-presence { width: 30px; height: 30px; }
  .active-avatar { font-size: 0.68rem; }
  .chat-header h2 { font-size: 1.05rem; }
  .chat-header .eyebrow { display: none; }
  .active-friend-presence { font-size: 0.68rem; }
  .chat-header-actions { gap: 6px; }

  .online-count-pill { display: none; }

  .remove-friend-btn {
    width: 34px; height: 34px; padding: 0;
    justify-content: center; border-radius: 50%;
    box-shadow: none;
  }
  .remove-friend-btn span { display: none; }

  .mob-back-btn {
    display: flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 50%;
    border: 1px solid var(--b1); background: rgba(255,255,255,0.05);
    color: var(--violet); cursor: pointer; padding: 0; box-shadow: none; flex-shrink: 0;
    transition: background 0.15s;
  }
  .mob-back-btn:hover {
    background: rgba(167,139,250,0.10); transform: none; filter: none; box-shadow: none;
  }
  :root.light .mob-back-btn { color: var(--violet-d); background: rgba(0,0,0,0.04); }

  .messages-wrap { flex: 1; min-height: 0; }
  .messages { padding: 12px 14px; gap: 10px; }
  .message { max-width: 86%; }
  .typing-indicator { padding: 0 14px; }

  .message-form-wrap { flex-shrink: 0; }
  .message-form {
    border-radius: 0; border: none; border-top: 1px solid var(--b1);
    background: var(--mob-bar-bg); backdrop-filter: blur(16px);
    padding: 10px 12px;
    padding-bottom: calc(10px + env(safe-area-inset-bottom, 0px));
  }
  .message-form input { font-size: 1rem; padding: 10px 12px; border-radius: var(--r2); }
  .message-form button {
    padding: 0 16px; min-width: 68px; height: 44px;
    border-radius: var(--r2); font-size: 0;
  }
  .message-form button svg { width: 18px; height: 18px; }
  .message-form button span { display: none; }

  .char-counter { padding: 0 14px 6px; }
  .toast {
    right: 12px; left: 12px; max-width: none;
    bottom: calc(16px + env(safe-area-inset-bottom, 0px));
  }
  #requestList { max-height: 130px; }
  .scroll-btn { bottom: 16px; right: 16px; }

  .chat-search-popover { margin: 0 10px; border-radius: 12px; }
  .message[data-ts-full]:hover::after { display: none; }
  .chat-search-popover button { padding: 0 8px; height: 30px; }

  .reply-banner { margin: 0 10px; }
}